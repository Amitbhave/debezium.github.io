<!DOCTYPE html> <html lang="en"> <head> <title>Integration Scenarios with Debezium and Apache Camel</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="" name="description"> <meta content="" name="author"> <link href="https://static.jboss.org/theme/css/bootstrap-community/3.2.0.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <!--[if lt IE 9]><script src="https://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--> <link href="https://static.jboss.org/example/images/favicon.ico" rel="shortcut icon"> <link href="https://static.jboss.org/example/images/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="https://static.jboss.org/example/images/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="https://static.jboss.org/example/images/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="https://static.jboss.org/example/images/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="/stylesheets/debezium.css" rel="stylesheet" type="text/css"> <style>
  @media (min-width: 980px) {
    .banner { background-image: url(https://static.jboss.org/example/images/debezium-banner-1180px.png); height: 110px;  }
  }
  @media (max-width: 979px) {
    .banner { background-image: url(https://static.jboss.org/example/images/debezium-logo.png); background-repeat:no-repeat; background-position: center bottom; height: 60px; }
  }
  @media (max-width: 650px) {
    .banner { width: 100%; margin: 0px auto; }
  }
  @media (max-width: 450px) {
    .banner { height: 90px; }
  }
</style> <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css" rel="stylesheet"> <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script> <script>
hljs.initHighlightingOnLoad();
</script> <script src="https://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <style>
  /* adjusting the vertical spacing for when a stickynav is engaged */
  .breadcrumb-fixed > .active {
    color: #8c8f91;
  }
  .breadcrumb-fixed {
    margin: 70px 0 10px;
    padding: 8px 15px;
    margin-bottom: 20px;
    list-style: none;
    background-color: #f5f5f5;
    border-radius: 4px;
  }
  
  .breadcrumb-fixed > li {
    display: inline-block;
  }
</style> </head> <body> <div id="rhbar"> <a class="jbdevlogo" href="https://www.jboss.org/projects/about"></a> <a class="rhlogo" href="https://www.redhat.com/"></a> </div> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div class="container" id="content"> <div class="navbar navbar-inverse navbar-fix"> <div class="container-fluid"> <div class="navbar-header"> <button class="navbar-toggle collapsed" data-target="#navbar-1" data-toggle="collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> <img src="/images/color_white_debezium_type_600px.svg" style="height: 32px; margin-right: 5px; margin-top: -5px;"> </a> </div> <div class="collapse navbar-collapse" id="navbar-1"> <ul class="nav navbar-nav pull-right"> <li class=""><a href="/documentation/faq/">FAQ</a></li> <li class=""><a href="/documentation/">DOCUMENTATION</a></li> <li class=""><a href="/releases/">RELEASES</a></li> <li class=""><a href="/community/">COMMUNITY</a></li> <li class="active"><a href="/blog/">BLOG</a></li> </ul> </div> </div> </div> <div id="equalHeightsLayout"> <div class="row post-text-padding row-no-expand"> <div class="hidden-xs col-sm-3 no-right-padding" id="leftdocnav" style="padding-left: 15px; padding-right: 15px;"> <div class="doc-pills"> <ul class="nav nav-pills nav-stacked"> <li class="item"> <a href="/blog">Home</a> <div class="icon"> <span class="icon-home"></span> </div> </li> <li class="item"> <a href="/blog.atom">Feed</a> <div class="icon"> <span class="icon-rss"></span> </div> </li> </ul> </div> <p></p> <div class="featured-posts"> <div id="featured" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;"> Featured Posts </div> <ul style="padding-inline-start: 22px;"> <li style="margin-bottom: 3px;"> <a href="/blog/2020/02/10/event-sourcing-vs-cdc/" style="font-size: 95%;"> Distributed Data for Microservices â€” Event Sourcing vs. Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/10/01/audit-logs-with-change-data-capture-and-stream-processing/" style="font-size: 95%;"> Building Audit Logs with Change Data Capture and Stream Processing </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/07/12/streaming-cassandra-at-wepay-part-1/" style="font-size: 95%;"> Streaming Cassandra at WePay - Part 1 </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2019/02/19/reliable-microservices-data-exchange-with-the-outbox-pattern/" style="font-size: 95%;"> Reliable Microservices Data Exchange With the Outbox Pattern </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/12/05/automating-cache-invalidation-with-change-data-capture/" style="font-size: 95%;"> Automating Cache Invalidation With Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/09/20/materializing-aggregate-views-with-hibernate-and-debezium/" style="font-size: 95%;"> Materializing Aggregate Views With Hibernate and Debezium </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/07/19/advantages-of-log-based-change-data-capture/" style="font-size: 95%;"> Five Advantages of Log-Based Change Data Capture </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/03/08/creating-ddd-aggregates-with-debezium-and-kafka-streams/" style="font-size: 95%;"> Creating DDD aggregates with Debezium and Kafka Streams </a> </li> <li style="margin-bottom: 3px;"> <a href="/blog/2018/01/17/streaming-to-elasticsearch/" style="font-size: 95%;"> Streaming Data Changes from Your Database to Elasticsearch </a> </li> </ul> </div> <p></p> <div class="cloud-tags"> <div id="tags" style="margin-bottom: 4px; border-bottom: 1px solid #ccc; font-size: 115%; margin-left: 2px;"> Tags </div> <div class="tag-cloud"> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/apache-kafka/">apache-kafka</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/apicurio/">apicurio</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/avro/">avro</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/aws/">aws</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/camel/">camel</a> </span> <span class="tag tag-2"> <a href="https://debezium.io/blog/tags/cassandra/">cassandra</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/community/">community</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/cqrs/">cqrs</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/db2/">db2</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/debezium-server/">debezium-server</a> </span> <span class="tag tag-2"> <a href="https://debezium.io/blog/tags/discussion/">discussion</a> </span> <span class="tag tag-4"> <a href="https://debezium.io/blog/tags/docker/">docker</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/elasticsearch/">elasticsearch</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/event-sourcing/">event-sourcing</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/example/">example</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/examples/">examples</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/featured/">featured</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/fedora/">fedora</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/integration/">integration</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/introduction/">introduction</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/json/">json</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/kafka/">kafka</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/kafka-streams/">kafka-streams</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/kogito/">kogito</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/ksql/">ksql</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/kubernetes/">kubernetes</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/microservices/">microservices</a> </span> <span class="tag tag-4"> <a href="https://debezium.io/blog/tags/mongodb/">mongodb</a> </span> <span class="tag tag-6"> <a href="https://debezium.io/blog/tags/mysql/">mysql</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/news/">news</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/newsletter/">newsletter</a> </span> <span class="tag tag-3"> <a href="https://debezium.io/blog/tags/oracle/">oracle</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/outbox/">outbox</a> </span> <span class="tag tag-5"> <a href="https://debezium.io/blog/tags/postgres/">postgres</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/presentation/">presentation</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/production/">production</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/quarkus/">quarkus</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/rds/">rds</a> </span> <span class="tag tag-6"> <a href="https://debezium.io/blog/tags/releases/">releases</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/schema/">schema</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/secrets/">secrets</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/sentry/">sentry</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/serialization/">serialization</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/smt/">smt</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/sql/">sql</a> </span> <span class="tag tag-3"> <a href="https://debezium.io/blog/tags/sqlserver/">sqlserver</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/testcontainers/">testcontainers</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/topics/">topics</a> </span> <span class="tag tag-0"> <a href="https://debezium.io/blog/tags/vagrant/">vagrant</a> </span> <span class="tag tag-1"> <a href="https://debezium.io/blog/tags/website/">website</a> </span> </div> </div> </div> <div class="col-xs-12 col-sm-9" id="maincol"> <div class="post"> <div class="row" style="margin-left: 0; margin-right: 0; margin-bottom: 10px;"> <div class="col-sm-12" style="padding-left: 0px;"> <div style="display: table-cell; vertical-align: top;"> <div style="width: 72px; border: 1px solid #ccc; padding: 3px; display: inline-block;"> <img src="/images/jpechane.jpg" style="width: 64px;"> </div> </div> <div style="display: table-cell; vertical-align: top;"> <div style="margin-left: 8px;"> <span class="hidden-sm hidden-xs" style="font-size: 2.75rem; line-height: 1;"> <a href="/blog/2020/02/19/debezium-camel-integration/">Integration Scenarios with Debezium and Apache Camel</a> </span> <span class="hidden-md hidden-lg" style="font-size: 2rem; line-height: 1;"> <a href="/blog/2020/02/19/debezium-camel-integration/">Integration Scenarios with Debezium and Apache Camel</a> </span> <div class="byline" style="line-height: 1;"> <em> February 19, 2020 by Jiri Pechanec </em> <div class="hidden-xs" style="margin-top: 5px;"> <a class="hidden-sm hidden-xs label label-info" href="/blog/tags/camel/">camel</a> <a class="hidden-sm hidden-xs label label-info" href="/blog/tags/integration/">integration</a> <a class="hidden-sm hidden-xs label label-info" href="/blog/tags/quarkus/">quarkus</a> </div> </div> </div> </div> </div> </div> <div class="row" style="margin-left: 0; margin-right: 0;"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>One of the typical Debezium uses cases is to use change data capture to integrate a legacy system with other systems in the organization. There are multiple ways how to achieve this goal</p> </div> <div class="ulist"> <ul> <li> <p>Write data to Kafka using Debezium and follow with a combination of Kafka Streams pipelines and Kafka Connect connectors to deliver the changes to other systems</p> </li> <li> <p>Use <a href="https://debezium.io/documentation/reference/1.1/operations/embedded.html">Debezium Embedded engine</a> in a Java standalone application and write the integration code using plain Java; that&#8217;s often used to send change events to alternative messaging infrastructure such as Amazon Kinesis, Google Pub/Sub etc.</p> </li> <li> <p>Use an existing integration framework or service bus to express the pipeline logic</p> </li> </ul> </div> <div class="paragraph"> <p>This article is focusing on the third option - a dedicated integration framework.</p> </div> </div> </div> <div class="sect1"> <h2 id="apache_camel"><a class="anchor" href="#apache_camel"></a>Apache Camel</h2> <div class="sectionbody"> <div class="paragraph"> <p><a href="https://camel.apache.org/">Camel</a> is an open-source integration framework that enables developers to read, transform, route and write data from and to disparate systems and services. It provides a large amount of ready-made <a href="https://camel.apache.org/components/latest/">components</a> that either provide interfaces to 3rd party systems or offers an implementation of <a href="https://en.wikipedia.org/wiki/Enterprise_Integration_Patterns">enterprise integration patterns</a>.</p> </div> <div class="paragraph"> <p>This combination allows the developer to easily connect to target systems and express integration pipelines using a declarative DSL.</p> </div> <div class="sect2"> <h3 id="camel_and_debezium"><a class="anchor" href="#camel_and_debezium"></a>Camel and Debezium</h3> <div class="paragraph"> <p><a href="https://camel.apache.org/blog/Camel3-Whatsnew/">Camel 3</a> has been released by the end of the year 2019 and in addition to the major re-architecture new Debezium components have been added to the codebase. It also enables Camel to be used as <a href="https://camel.apache.org/camel-kafka-connector/latest/index.html">a connector</a> in Kafka Connect runtime.</p> </div> <div class="paragraph"> <p>This post focuses solely on Debezium components use and the latter option will be covered in a future post.</p> </div> <div class="ulist"> <ul> <li> <p><a href="https://camel.apache.org/components/latest/debezium-mysql-component.html">Debezium MySQL Connector Component</a></p> </li> <li> <p><a href="https://camel.apache.org/components/latest/debezium-postgres-component.html">Debezium PostgreSQL Connector Component</a></p> </li> <li> <p><a href="https://camel.apache.org/components/latest/debezium-sqlserver-component.html">Debezium SQL Server Connector Component</a></p> </li> <li> <p><a href="https://camel.apache.org/components/latest/debezium-mongodb-component.html">Debezium MongoDB Connector Component</a></p> </li> </ul> </div> <div class="paragraph"> <p>As you can see every <em>non-incubating</em> Debezium connector is represented by its dedicated component. The advantage of this solution is the complete isolation of dependencies and the type-safe configuration of connector instances.</p> </div> <div class="paragraph"> <p>Internally the component exposes a Debezium <a href="https://camel.apache.org/manual/latest/endpoint.html">endpoint</a> with an event-driven <a href="https://www.javadoc.io/doc/org.apache.camel/camel-api/latest/org/apache/camel/Consumer.html">Camel consumer</a> that encapsulates an instance of the <a href="https://debezium.io/documentation/reference/1.1/operations/embedded.html">Debezium embedded engine</a>.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="an_example"><a class="anchor" href="#an_example"></a>An Example</h2> <div class="sectionbody"> <div class="paragraph"> <p>As an example we&#8217;ve built a simple Question &amp; Answer (Q &amp; A) application, loosely inspired by StackOverflow and the likes. A REST API allows to post new questions as well as answers to existing questions, which are stored in a database.</p> </div> <div class="paragraph"> <p>Any data changes generated by the application (e.g. if a new question or answer got created) are captured via Debezium and passed to the Camel pipeline, which sends emails via an SMTP server and posts a corresponding tweet on a provided Twitter account.</p> </div> <div class="paragraph"> <p>You can find the complete <a href="https://github.com/debezium/debezium-examples/tree/master/camel-component">source code</a> of the example on GitHub.</p> </div> <div class="sect2"> <h3 id="topology"><a class="anchor" href="#topology"></a>Topology</h3> <div class="paragraph"> <p>There are multiple components in the solution topology:</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/images/camel-component-topology.svg" style="max-width:100%;" class="responsive-image"> <div class="paragraph"> <p><strong>Figure 1. The Deployment Topology</strong></p> </div> </div> </div> <div class="ulist"> <ul> <li> <p>The Q &amp; A application is implemented using the <a href="https://quarkus.io/">Quarkus</a> stack and exposes a REST API to create questions and answers</p> </li> <li> <p>The application stores its data in the PostgreSQL database</p> </li> <li> <p>The Camel route runs as a plain Java application that uses an embedded <a href="https://infinispan.org/">Infinispan</a> store to persist its state (used to build an aggregate object linking questions to their answers) and sends messages to about answered questions via e-mail and to an associated Twitter account</p> </li> <li> <p>A <a href="https://github.com/mailhog/MailHog">MailHog</a> SMTP server running in a container for sending e-mails</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="question_answer_application"><a class="anchor" href="#question_answer_application"></a>Question &amp; Answer Application</h3> <div class="paragraph"> <p>The source application is a simple REST service based on Quarkus. It manages two entities, <code>Question</code> and <code>Answer</code>, with a <code>1:n</code> relation stored in the PostgreSQL database.</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/images/camel-component-erd.svg" style="max-width:100%;" class="responsive-image"> <div class="paragraph"> <p><strong>Figure 2. The Q&amp;A Backend Service Entity Relationship Diagram</strong></p> </div> </div> </div> <div class="paragraph"> <p>The entities are created using REST API and the association is automatically established between them.</p> </div> </div> <div class="sect2"> <h3 id="the_camel_pipeline"><a class="anchor" href="#the_camel_pipeline"></a>The Camel Pipeline</h3> <div class="paragraph"> <p>The Camel pipeline is an expression of the following business rules:</p> </div> <div class="ulist"> <ul> <li> <p>For every question created or updated send an email to the question creator</p> </li> <li> <p>For every answer created or updated send an email to both question and answer creator</p> </li> <li> <p>When a question achieves three answers post a tweet on a dedicated Twitter account about it</p> </li> </ul> </div> <div class="paragraph"> <p>The business requirements are transformed into a pipeline described by this EIP chart:</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/images/camel-component-pipeline.svg" style="max-width:90%;" class="responsive-image"> <div class="paragraph"> <p><strong>Figure 4. The Camel Pipeline</strong></p> </div> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="code_walkthrough"><a class="anchor" href="#code_walkthrough"></a>Code Walkthrough</h2> <div class="sectionbody"> <div class="paragraph"> <p>To use Debezium Camel component we need to add at least following dependencies into a <code>pom.xml</code> file</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencyManagement&gt;&#x000A;  &lt;dependencies&gt;&#x000A;    &lt;dependency&gt;&#x000A;      &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;&#x000A;      &lt;artifactId&gt;camel-bom&lt;/artifactId&gt;&#x000A;      &lt;version&gt;${version.camel}&lt;/version&gt;&#x000A;      &lt;type&gt;pom&lt;/type&gt;&#x000A;      &lt;scope&gt;import&lt;/scope&gt;&#x000A;    &lt;/dependency&gt;&#x000A;&#x000A;    &lt;!-- Use required Debezium version --&gt;&#x000A;    &lt;dependency&gt;&#x000A;      &lt;groupId&gt;io.debezium&lt;/groupId&gt;&#x000A;      &lt;artifactId&gt;debezium-connector-postgres&lt;/artifactId&gt;&#x000A;      &lt;version&gt;${version.debezium}&lt;/version&gt;&#x000A;    &lt;/dependency&gt;&#x000A;    &lt;dependency&gt;&#x000A;      &lt;groupId&gt;io.debezium&lt;/groupId&gt;&#x000A;      &lt;artifactId&gt;debezium-embedded&lt;/artifactId&gt;&#x000A;      &lt;version&gt;${version.debezium}&lt;/version&gt;&#x000A;    &lt;/dependency&gt;&#x000A;    &lt;dependency&gt;&#x000A;      &lt;groupId&gt;io.debezium&lt;/groupId&gt;&#x000A;      &lt;artifactId&gt;debezium-core&lt;/artifactId&gt;&#x000A;      &lt;version&gt;${version.debezium}&lt;/version&gt;&#x000A;    &lt;/dependency&gt;&#x000A;&#x000A;  &lt;/dependencies&gt;&#x000A;&lt;/dependencyManagement&gt;&#x000A;&lt;dependencies&gt;&#x000A;  &lt;dependency&gt;&#x000A;    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;&#x000A;    &lt;artifactId&gt;camel-core&lt;/artifactId&gt;&#x000A;  &lt;/dependency&gt;&#x000A;  &lt;dependency&gt;&#x000A;    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;&#x000A;    &lt;artifactId&gt;camel-debezium-postgres&lt;/artifactId&gt;&#x000A;  &lt;/dependency&gt;&#x000A;&lt;/dependencies&gt;</code></pre> </div> </div> <div class="paragraph"> <p>The pipeline logic itself is defined in <a href="https://github.com/debezium/debezium-examples/blob/master/camel-component/qa-camel/src/main/java/io/debezium/examples/camel/pipeline/QaDatabaseUserNotifier.java">QaDatabaseUserNotifier</a> class. Its main route looks like tis:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">public class QaDatabaseUserNotifier extends RouteBuilder {&#x000A;&#x000A;  @Override&#x000A;  public void configure() throws Exception {&#x000A;    from("debezium-postgres:localhost?"&#x000A;        + "databaseHostname={{database.hostname}}"&#x000A;        + "&amp;databasePort={{database.port}}"&#x000A;        + "&amp;databaseUser={{database.user}}"&#x000A;        + "&amp;databasePassword={{database.password}}"&#x000A;        + "&amp;databaseDbname=postgres"&#x000A;        + "&amp;databaseServerName=qa"&#x000A;        + "&amp;schemaWhitelist={{database.schema}}"&#x000A;        + "&amp;tableWhitelist={{database.schema}}.question,{{database.schema}}.answer"&#x000A;        + "&amp;offsetStorage=org.apache.kafka.connect.storage.MemoryOffsetBackingStore")&#x000A;        .routeId(QaDatabaseUserNotifier.class.getName() + ".DatabaseReader")     <i class="conum" data-value="1"></i><b>(1)</b>&#x000A;        .log(LoggingLevel.DEBUG, "Incoming message ${body} with headers ${headers}")&#x000A;        .choice()                                                                <i class="conum" data-value="2"></i><b>(2)</b>&#x000A;          .when(isQuestionEvent)&#x000A;            .filter(isCreateOrUpdateEvent)                                       <i class="conum" data-value="3"></i><b>(3)</b>&#x000A;              .convertBodyTo(Question.class)                                     <i class="conum" data-value="4"></i><b>(4)</b>&#x000A;              .log(LoggingLevel.TRACE, "Converted to logical class ${body}")&#x000A;              .bean(store, "readFromStoreAndUpdateIfNeeded")                     <i class="conum" data-value="5"></i><b>(5)</b>&#x000A;              .to(ROUTE_MAIL_QUESTION_CREATE)                                    <i class="conum" data-value="6"></i><b>(6)</b>&#x000A;            .endChoice()&#x000A;          .when(isAnswerEvent)&#x000A;            .filter(isCreateOrUpdateEvent)&#x000A;              .convertBodyTo(Answer.class)&#x000A;              .log(LoggingLevel.TRACE, "Converted to logical class ${body}")&#x000A;              .bean(store, "readFromStoreAndAddAnswer")&#x000A;              .to(ROUTE_MAIL_ANSWER_CHANGE)&#x000A;              .filter(hasManyAnswers)                                            <i class="conum" data-value="7"></i><b>(7)</b>&#x000A;                .setBody().simple("Question '${exchangeProperty[aggregate].text}' has " +&#x000A;                    "many answers (generated at " + Instant.now() + ")")&#x000A;                .to(TWITTER_SERVER)&#x000A;              .end()&#x000A;            .endChoice()&#x000A;          .otherwise()&#x000A;            .log(LoggingLevel.WARN, "Unknown type ${headers[" +&#x000A;                DebeziumConstants.HEADER_IDENTIFIER + "]}")&#x000A;        .endParent();&#x000A;&#x000A;    from(ROUTE_MAIL_QUESTION_CREATE)                                             <i class="conum" data-value="6"></i><b>(6)</b>&#x000A;      .routeId(QaDatabaseUserNotifier.class.getName() + ".QuestionNotifier")&#x000A;      .setHeader("To").simple("${body.email}")&#x000A;      .setHeader("Subject").simple("Question created/edited")&#x000A;      .setBody().simple("Question '${body.text}' was created or edited")&#x000A;      .to(SMTP_SERVER);&#x000A;  }&#x000A;&#x000A;  @Converter&#x000A;  public static class Converters {&#x000A;&#x000A;    @Converter&#x000A;    public static Question questionFromStruct(Struct struct) {                   <i class="conum" data-value="4"></i><b>(4)</b>&#x000A;      return new Question(struct.getInt64("id"), struct.getString("text"),&#x000A;          struct.getString("email"));&#x000A;    }&#x000A;&#x000A;    @Converter&#x000A;    public static Answer answerFromStruct(Struct struct) {                       <i class="conum" data-value="4"></i><b>(4)</b>&#x000A;      return new Answer(struct.getInt64("id"), struct.getString("text"),&#x000A;          struct.getString("email"), struct.getInt64("question_id"));&#x000A;    }&#x000A;  }&#x000A;}</code></pre> </div> </div> <div class="colist arabic"> <table> <tr> <td><i class="conum" data-value="1"></i><b>1</b></td> <td><code>from</code> is the Debezium source endpoint. The URI parts map directly to connector configuration options.</td> </tr> <tr> <td><i class="conum" data-value="2"></i><b>2</b></td> <td>The pipeline logic is split depending on the change event type. The recognition is based on <code>CamelDebeziumIdentifier</code> header which contains the identifier (<code>&lt;server_name&gt;.&lt;schema_name&gt;.&lt;table_name&gt;</code>) of the source table.</td> </tr> <tr> <td><i class="conum" data-value="3"></i><b>3</b></td> <td>The pipeline is now able to process only updates and deletes. The recognition is based on <code>CamelDebeziumOperation</code> header that contains <code>op</code> field of the message <code>Envelope</code>.</td> </tr> <tr> <td><i class="conum" data-value="4"></i><b>4</b></td> <td>The Kafka Connect&#8217;s <code>Struct</code> type is converted into a logical type used in the pipeline. The conversion is performed by a custom Camel converter. It is possible to use out-of-the-box <code>DebeziumTypeConverter</code> that converts <code>Struct</code> into a <code>Map</code> but this tightly couples pipeline logic into the table structure.</td> </tr> <tr> <td><i class="conum" data-value="5"></i><b>5</b></td> <td>A supplementary route is invoked that communicates with a <a href="https://github.com/debezium/debezium-examples/blob/master/camel-component/qa-camel/src/main/java/io/debezium/examples/camel/pipeline/AggregateStore.java">message store</a> based on an Infinispan cache to build a message aggregate. The message store checks if it has the question already stored. If not a new aggregate is created and stored otherwise the stored aggregate is updated with new data.</td> </tr> <tr> <td><i class="conum" data-value="6"></i><b>6</b></td> <td>A supplementary route is invoked that formats a mail message and delivers it to the question creator via the SMTP endpoint.</td> </tr> <tr> <td><i class="conum" data-value="7"></i><b>7</b></td> <td>The route part related to the answer message type is very similar (answers are added to question aggregate). The main difference is the posting of a Twitter message when the aggregate contains three answers.</td> </tr> </table> </div> <div class="paragraph"> <p>On a side note, for the sake of simplicitiy, the example currently uses volatile memory to store the Debezium offsets. For persistent storage you could either use a file-based offset store or create a custom offset store implementation based on Infinispan, delegating the storage of offsets to the underlying cache.</p> </div> </div> </div> <div class="sect1"> <h2 id="demo"><a class="anchor" href="#demo"></a>Demo</h2> <div class="sectionbody"> <div class="paragraph"> <p>In order to run the demo, you need to have a Twitter <a href="https://developer.twitter.com/en/docs/basics/getting-started">developer account</a> with appropriate API keys and secrets.</p> </div> <div class="paragraph"> <p>Go to the application directory and build all components:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-shell" data-lang="shell">$ mvn clean install</code></pre> </div> </div> <div class="paragraph"> <p>Start the services (provide your own Twitter API credentials):</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-shell" data-lang="shell">$ env TWITTER_CONSUMER_KEY=&lt;...&gt; TWITTER_CONSUMER_SECRET=&lt;...&gt; TWITTER_ACCESS_TOKEN=&lt;...&gt; TWITTER_ACCESS_TOKEN_SECRET=&lt;...&gt; docker-compose up</code></pre> </div> </div> <div class="paragraph"> <p>In another terminal create a question and three answers to it:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-shell" data-lang="shell">$ curl -v -X POST -H 'Content-Type: application/json' http://0.0.0.0:8080/question/ -d @src/test/resources/messages/create-question.json&#x000A;$ curl -v -X POST -H 'Content-Type: application/json' http://0.0.0.0:8080/question/1/answer -d @src/test/resources/messages/create-answer1.json&#x000A;$ curl -v -X POST -H 'Content-Type: application/json' http://0.0.0.0:8080/question/1/answer -d @src/test/resources/messages/create-answer2.json&#x000A;$ curl -v -X POST -H 'Content-Type: application/json' http://0.0.0.0:8080/question/1/answer -d @src/test/resources/messages/create-answer3.json</code></pre> </div> </div> <div class="paragraph"> <p>The Twitter account should contain a new tweet with a text like "Question 'How many legs does a dog have?' has many answers (generated at 2020-02-17T08:02:33.744Z)". Also the <a href="http://localhost:8025/">MailHog server UI</a> should display messages like these:</p> </div> <div class="exampleblock centered-image responsive-image"> <div class="content"> <img src="/images/camel-component-mailhog.png" style="max-width:100%;" class="responsive-image"> <div class="paragraph"> <p><strong>Figure 4. The MailHog Messages</strong></p> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2> <div class="sectionbody"> <div class="paragraph"> <p>Apache Camel is a very interesting option for implementing system integration scenarios.</p> </div> <div class="paragraph"> <p>Without the need for any external messaging infrastructure, it is very easy to deploy a standalone Camel route with the Debezium component, enabling the capture of data changes and execution of complex routing and transformation operations on them. Camel equips the developer with a full arsenal of enterprise integration pattern implementations, as well as more than hundred connectors for different systems that could be included in a complex service orchestration.</p> </div> <div class="paragraph"> <p>The source code of the full example is available <a href="https://github.com/debezium/debezium-examples/tree/master/camel-component">on GitHub</a>.</p> </div> </div> </div> <div class="sect1"> <h2 id="about_debezium"><a class="anchor" href="#about_debezium"></a>About Debezium</h2> <div class="sectionbody"> <div class="paragraph"> <p>Debezium is an open-source distributed platform that turns your existing databases into event streams, so applications can see and respond almost instantly to each committed row-level change in the databases. Debezium is built on top of <a href="http://kafka.apache.org/">Kafka</a> and provides <a href="http://kafka.apache.org/documentation.html#connect">Kafka Connect</a> compatible connectors that monitor specific database management systems. Debezium records the history of data changes in Kafka logs, so your application can be stopped and restarted at any time and can easily consume all of the events it missed while it was not running, ensuring that all events are processed correctly and completely. Debezium is <a href="/license/">open source</a> under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, Version 2.0</a>.</p> </div> </div> </div> <div class="sect1"> <h2 id="get_involved"><a class="anchor" href="#get_involved"></a>Get involved</h2> <div class="sectionbody"> <div class="paragraph"> <p>We hope you find Debezium interesting and useful and want to give it a try. Follow us on Twitter <a href="https://twitter.com/debezium">@debezium</a>, <a href="https://gitter.im/debezium/user">chat with us on Gitter</a>, or join our <a href="https://groups.google.com/forum/#!forum/debezium">mailing list</a> to talk with the community. All of the code is open-source <a href="https://github.com/debezium/">on GitHub</a>, so build the code locally and help us improve our existing connectors and add even more connectors. If you find problems or have an idea on how we can improve Debezium, please let us know or <a href="https://issues.redhat.com/projects/DBZ/issues/">log an issue</a>.</p> </div> </div> </div> </div> </div> <div class="well"> <div class="row"> <div class="col-md-8"> <h2>Jiri Pechanec</h2> <p> <span class="bio-size">Jiri is a software developer (and a former quality engineer) at Red Hat. He spent most of his career with Java and system integration projects and tasks. He lives near Brno, Czech Republic.</span> </p> <p class="bio-size"> <a href="https://github.com/jpechane"> <i class="icon-github"></i> </a> &nbsp; <a href="https://www.linkedin.com/in/jiripechanec"> <i class="icon-linkedin"></i> </a> &nbsp; </p> </div> <div class="col-md-4"> <img alt="" class="img-responsive pull-right portrait" src="/images/jpechane.jpg"> </div> </div> </div> <div class="comments"> <div id="disqus_thread"></div> <script type="text/javascript">
            var disqus_shortname = 'Debezium';
            var disqus_url = "https://debezium.io/blog/2020/02/19/debezium-camel-integration/";
            var disqus_developer = null;
            var disqus_identifier = null;
            (function() {
              var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
            })();
            </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=Debezium">comments powered by Disqus.</a></noscript> </div> </div> </div> </div> </div> <footer class="container"> <div class="row"> <div class="col-md-5 col-md-offset-1"> <h4>Debezium</h4> <p> &#169; 2020 Debezium Community <br> <br> <i class="icon-fire"></i> Mixed with <a href="http://twitter.github.com/bootstrap">Bootstrap</a>, baked by <a href="http://awestruct.org">Awestruct</a>. <br> <i class="icon-flag"></i> Website and docs licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>. <br> <i class="icon-flag-alt"></i> Code released under <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, v2.0</a>. <br> <i class="icon-file-alt"></i> <a href="https://www.redhat.com/legal/legal_statement.html" title="Terms">Terms</a> | <a href="https://www.redhat.com/legal/privacy_statement.html" title="Privacy Policy">Privacy</a> </p> </div> <div class="col-md-3"> <h4>Documentation</h4> <ul class="list-unstyled"> <li> <a href="/documentation/features" title="Features">Features</a> </li> <li> <a href="/documentation/install/stable/" title="Install">Install</a> </li> <li> <a href="/documentation/architecture/" title="Architecture">Architecture</a> </li> <li> <a href="/documentation/faq/" title="FAQ">FAQ</a> </li> <li> <a href="/community/contribute/" title="Contribute">Contribute</a> </li> </ul> </div> <div class="col-md-3"> <h4>Connect</h4> <ul class="list-unstyled"> <li> <a href="/blog" title="Blog">Blog</a> </li> <li> <a href="http://twitter.com/debezium" title="Twitter">Twitter</a> </li> <li> <a href="http://github.com/debezium" title="GitHub">GitHub</a> </li> <li> <a href="https://gitter.im/debezium/user" title="Chat">Chat</a> </li> <li> <a href="https://groups.google.com/forum/#!forum/debezium" title="Google Groups">Google Groups</a> </li> <li> <a href="http://stackoverflow.com/questions/tagged/debezium" title="StackOverflow">StackOverflow</a> </li> </ul> </div> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="https://www.redhat.com/"><img src="/images/Logo-Red_Hat-Sponsored_By-B-Standard-RGB.svg"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="https://static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.2/bootstrap-community.min.js"></script> <script type='text/javascript' language='JavaScript' src='https://www.redhat.com/j/elqNow/elqCfg.js'></script> <script type='text/javascript' language='JavaScript' src='https://www.redhat.com/j/elqNow/elqImg.js'></script> <div id="oTags"> <script type="text/javascript" src="//www.redhat.com/j/s_code.js"></script> <script type="text/javascript"><!--
  var coreUrl = encodeURI(document.URL.split("?")[0]).replace(/-/g," ");
  var urlSplit = coreUrl.toLowerCase().split(/\//);
  var urlLast = urlSplit[urlSplit.length-1];
  var pageNameString = "";
  var siteName = "";
  var minorSectionIndex = 3
  if (urlLast == "") {
      urlSplit.splice(-1,1);
  }
  if (urlLast.search(/\./) >= 0) {
      if (urlLast == "index.html") {
          urlSplit.splice(-1,1);
      }
      else {
          urlSplit[urlSplit.length-1] = urlLast.split(".").splice(0,1);
      }
  }
  siteName = urlSplit[2].split(".")[1];
  s.prop14 = s.eVar27 = siteName || "";
  s.prop15 = s.eVar28 = urlSplit[minorSectionIndex] || "";
  s.prop16 = s.eVar29 = urlSplit[minorSectionIndex+1] || "";
  pageNameString = urlSplit.splice(3).join(" | ");
  s.pageName = "jboss | community | " + siteName + " | " + pageNameString;
  s.server = "jboss";
  s.channel = "jboss | community";
  s.prop4 = s.eVar23 = encodeURI(document.URL);
  s.prop21 = s.eVar18 = coreUrl;
  s.prop2 = s.eVar22 = "en";
  s.prop3 = s.eVar19 = "us";
  //--></script> <script type="text/javascript" src="//www.redhat.com/j/rh_omni_footer.js"></script> <script language="JavaScript" type="text/javascript"><!--
  if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
  //--></script> <noscript><a href="http://www.omniture.com" title="Web Analytics"><img src="https://smtrcs.redhat.com/b/ss/redhatcom,redhatglobal/1/H.25.4--NS/0?[AQB]&cdp=3&[AQE]" height="1" width="1" border="0" alt=""/></a></noscript> </div> <script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script> <script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-10656779-1");
pageTracker._trackPageview();
} catch(err) {}</script> <script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-76464546-1', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);
ga('require', 'linkid', 'linkid.js');

</script> </div> </body> </html>