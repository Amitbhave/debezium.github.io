<!DOCTYPE html> <html lang="en"> <head> <title>Debezium Connector for MySQL</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="" name="description"> <meta content="" name="author"> <link href="http://static.jboss.org/theme/css/bootstrap-community/3.2.0.1/bootstrap-community.min.css" media="screen" rel="stylesheet"> <!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--> <link href="http://static.jboss.org/example/images/favicon.ico" rel="shortcut icon"> <link href="http://static.jboss.org/example/images/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="http://static.jboss.org/example/images/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="http://static.jboss.org/example/images/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="http://static.jboss.org/example/images/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="/stylesheets/debezium.css" rel="stylesheet" type="text/css"> <style>
      @media (min-width: 980px) {
        .banner { background-image: url(http://static.jboss.org/example/images/debezium-banner-1180px.png); height: 110px;  }
      }
      @media (max-width: 979px) {
        .banner { background-image: url(http://static.jboss.org/example/images/debezium-logo.png); background-repeat:no-repeat; background-position: center bottom; height: 60px; }
      }
      @media (max-width: 650px) {
        .banner { width: 100%; margin: 0px auto; }
      }
      @media (max-width: 450px) {
        .banner { height: 90px; }
      }
    </style> <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css" rel="stylesheet"> <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script src="http://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <style>
      /* adjusting the vertical spacing for when a stickynav is engaged */
      .breadcrumb-fixed > .active {
        color: #8c8f91;
      }
      .breadcrumb-fixed {
        margin: 70px 0 10px;
        padding: 8px 15px;
        margin-bottom: 20px;
        list-style: none;
        background-color: #f5f5f5;
        border-radius: 4px;
      }
      
      .breadcrumb-fixed > li {
        display: inline-block;
      }
    </style> </head> <body> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div class="container" id="content"> <div class="navbar navbar-inverse navbar-fix"> <div class="container-fluid"> <div class="navbar-header"> <button class="navbar-toggle collapsed" data-target="#navbar-1" data-toggle="collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> Debezium </a> </div> <div class="collapse navbar-collapse" id="navbar-1"> <ul class="nav navbar-nav pull-right"> <li class=""><a href="/docs/faq">FAQ</a></li> <li class="active"><a href="/docs">DOCS</a></li> <li class=""><a href="/community">COMMUNITY</a></li> <li class=""><a href="/blog">BLOG</a></li> </ul> </div> </div> </div> <div id="equalHeightsLayout"> <div class="col-sm-3" id="leftdocnav"> <div class="panel-group" id="accordion1"> <div class="panel panel-docnav"> <div class="panel-heading"> <h4 class="panel-title"> <a class="accordion-toggle" data-parent="#accordion1,#accordion2,#accordion3,#accordion4" data-toggle="collapse" href="#collapse1"> Get Started </a> </h4> </div> <div class="collapse panel-collapse" id="collapse1"><div class="panel-body"> <ul class="list-group"> <li class="list-group-item"><a href="/docs/concepts">Concepts</a></li> <li class="list-group-item"><a href="/docs/tutorial">Tutorial</a></li> <li class="list-group-item"><a href="/docs/install">Installing Debezium</a></li> <li class="list-group-item"><a href="/docs/embedded">Embedding Debezium</a></li> <li class="list-group-item"><a href="/docs/releases">Releases</a></li> </ul> </div></div> </div> </div> <div class="panel-group" id="accordion2"> <div class="panel panel-docnav"> <div class="panel-heading"> <h4 class="panel-title"> <a class="accordion-toggle" data-parent="#accordion1,#accordion2,#accordion3,#accordion4" data-toggle="collapse" href="#collapse2"> Connectors </a> </h4> </div> <div class="collapse in panel-collapse" id="collapse2"><div class="panel-body"> <ul class="list-group"> <li class="active list-group-item"><a href="/docs/connectors/mysql">MySQL</a></li> <li class="list-group-item"><a href="/docs/connectors/mongodb">MongoDB</a></li> <li class="list-group-item"><a href="/docs/connectors/postgresql">PostgreSQL</a></li> <li class="list-group-item"><a href="/docs/connectors/oracle">Oracle</a></li> </ul> </div></div> </div> </div> <div class="panel-group" id="accordion3"> <div class="panel panel-docnav"> <div class="panel-heading"> <h4 class="panel-title"> <a class="accordion-toggle" data-parent="#accordion1,#accordion2,#accordion3,#accordion4" data-toggle="collapse" href="#collapse3"> How it works </a> </h4> </div> <div class="collapse panel-collapse" id="collapse3"><div class="panel-body"> <ul class="list-group"> <li class="list-group-item"><a href="/docs/faq">FAQ</a></li> <li class="list-group-item"><a href="/docs/architecture">Debezium Architecture</a></li> <li class="list-group-item"><a href="/docs/features">Debezium Features</a></li> </ul> </div></div> </div> </div> <div class="panel-group" id="accordion4"> <div class="panel panel-docnav"> <div class="panel-heading"> <h4 class="panel-title"> <a class="accordion-toggle" data-parent="#accordion1,#accordion2,#accordion3,#accordion4" data-toggle="collapse" href="#collapse4"> Contribute </a> </h4> </div> <div class="collapse panel-collapse" id="collapse4"><div class="panel-body"> <ul class="list-group"> <li class="list-group-item"><a href="/docs/contribute">Contribute to Debezium</a></li> <li class="list-group-item"><a href="/docs/code-of-conduct">Code of Conduct</a></li> <li class="list-group-item"> <a href="https://twitter.com/debezium">Twitter</a> </li> <li class="list-group-item"> <a href="https://gitter.im/debezium/dev">Chat</a> </li> <li class="list-group-item"> <a href="https://github.com/debezium/">Code</a> </li> <li class="list-group-item"> <a href="https://issues.jboss.org/projects/DBZ/issues">Issues</a> </li> </ul> </div></div> </div> </div> </div> <div class="col-sm-9" id="maincol"> <h1 class="title"> Debezium Connector for MySQL </h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Debezium&#8217;s MySQL Connector can monitor and record all of the row-level changes in the databases on a MySQL server or HA MySQL cluster. The first time it connects to a MySQL server/cluster, it reads a consistent snapshot of all of the databases. When that snapshot is complete, the connector continuously reads the changes that were committed to MySQL and generates corresponding insert, update and delete events. All of the events for each table are recorded in a separate Kafka topic, where they can be easily consumed by applications and services.</p> </div> </div> </div> <div class="sect1"> <h2 id="overview">Overview</h2> <div class="sectionbody"> <div class="paragraph"> <p>MySQL&#8217;s <a href="http://dev.mysql.com/doc/refman/5.7/en/binary-log.html"><em>binary log</em></a>, or <em>binlog</em>, records all operations in the same order they are committed by the database, including changes to the schemas of tables or changes to data stored within the tables. MySQL uses its binlog for replication and recovery.</p> </div> <div class="paragraph"> <p>Debezium&#8217;s MySQL connector reads MySQL&#8217;s binary log to understand what and in what order data has changed. It then produces a <em>change event</em> for every row-level insert, update, and delete operation in the binlog, recording all the change events for each table in a separate Kafka topic. Your client applications read the Kafka topics that correspond to the database tables it&#8217;s interested in following, and react to every row-level event it sees in those topics.</p> </div> <div class="paragraph"> <p>MySQL is usually set up to purge the binary logs after some period of time. This means that the binary log won&#8217;t have the complete history of all changes that have been made to the database. Therefore, when the MySQL connector first connects to a particular MySQL sever or cluster, it starts by performing a <em>consistent snapshot</em> of each of the databases. When the connector completes the snapshot, it then starts reading the binlog from the exact point at which the snapshot was made. This way, we start with a consistent view of all of the data, yet continue reading without having lost any of the changes made while the snapshot was being made.</p> </div> <div class="paragraph"> <p>The connector is also very tolerant of failures. As the connector reads the binlog and produces events, it records the binlog position with each event. If the connector stops for any reason (including communication failures, network problems, or crashes), upon restart it simply continues reading the binlog where it last left off. This includes snapshots: if the snapshot was not completed when the connector is stopped, upon restart it will begin a new snapshot. We&#8217;ll talk later about how the connector behaves <a href="#when-things-go-wrong">when things go wrong</a>.</p> </div> </div> </div> <div class="sect1"> <h2 id="setting-up-mysql">Setting up MySQL</h2> <div class="sectionbody"> <div class="paragraph"> <p>Before the Debezium MySQL connector can be used to monitor the changes committed on a MySQL server, the server must be set up to use <em>row-level binary logging</em> and have a database user with appropriate privileges. If MySQL is configured to use global transaction identifiers (GTIDs), then the Debezium connector can more easily reestablish connection should one of the MySQL servers fail.</p> </div> <div class="paragraph"> <p>The following sections outline in more detail how to set up these features in MySQL.</p> </div> <div class="sect2"> <h3 id="enabling-the-binlog">Enabling the binlog</h3> <div class="paragraph"> <p>The MySQL server must be configured to use a <em>row-level</em> binary log, which is described in more detail in the <a href="http://dev.mysql.com/doc/refman/5.7/en/replication-options.html">MySQL documentation</a>. This is most often done in the MySQL server configuration file, and will look similar to the following fragement:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code>server-id         = 223344&#x000A;log_bin           = mysql-bin&#x000A;binlog_format     = row&#x000A;expire_logs_days  = 10</code></pre> </div> </div> <div class="paragraph"> <p>where:</p> </div> <div class="ulist"> <ul> <li> <p>the value for <a href="http://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_server_id"><code>server-id</code></a> must be unique for each server and replication client within the MySQL cluster. When we set up the connector, we&#8217;ll also assign the connector a unique server ID.</p> </li> <li> <p>the value for <a href="http://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_log_bin"><code>log_bin</code></a> is the base name for the sequence of binlog files.</p> </li> <li> <p>the value for <a href="http://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_binlog_format"><code>binlog_format</code></a> must be set to <code>row</code> or <code>ROW</code>.</p> </li> <li> <p>the value for <a href="http://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_expire_logs_days"><code>expire_log_days</code></a> is the number of days for automatic binary log file removal. The default is 0, which means "no automatic removal," so be sure to set a value that is appropriate for your environment.</p> </li> </ul> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="paragraph"> <p>Running a MySQL server with binary logging enabled does slightly reduce performance of the MySQL server, but the benefits generally outweigh the costs. Each binlog reader will also place a small load on the server, so using Debezium is a great way to minimize this load while providing the change events to a large variety and number of consumers.</p> </div> </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="enabling-gtids-optional">Enabling GTIDs (optional)</h3> <div class="paragraph"> <p>The MySQL server can be configured to use <a href="https://dev.mysql.com/doc/refman/5.6/en/replication-gtids.html">GTID-based replication</a>. Global transaction identifiers, or GTIDs, were introduced in MySQL 5.6.5, and they uniquely identify a transaction that occurred on a particular server within a cluster. Using GTIDs greatly simplifies replication and makes it possible to easily confirm whether masters and slaves are consistent. <strong>Note that if you&#8217;re using an earlier version of MySQL, you will not be able to enable GTIDs.</strong></p> </div> <div class="paragraph"> <p>Enabling GTIDs can be done in the MySQL server configuration file, and will look similar to the following fragement:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code>gtid_mode                 = on&#x000A;enforce_gtid_consistency  = on</code></pre> </div> </div> <div class="paragraph"> <p>where:</p> </div> <div class="ulist"> <ul> <li> <p>the value for <a href="https://dev.mysql.com/doc/refman/5.6/en/replication-options-gtids.html#option_mysqld_gtid-mode"><code>gtid_mode</code></a> specifies the GTID mode of the MySQL server.</p> </li> <li> <p>the value for <a href="https://dev.mysql.com/doc/refman/5.6/en/replication-options-gtids.html"><code>enforce_gtid_consistency</code></a> instructs the server to enforce GTID consistency by allowing execution of only those statements that can be logged in a transactionally safe manner, and is required when using GTIDs.</p> </li> </ul> </div> <div class="paragraph"> <p>Consult the <a href="https://dev.mysql.com/doc/refman/5.6/en/replication-options-gtids.html#option_mysqld_gtid-mode">MySQL documentation</a> for details and specifics about setting up GTIDs.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="paragraph"> <p>The MySQL connector does not require MySQL to use GTIDs and GTID-based replication. Each time the connector starts up, it will automatically detect whether it is enabled and adjust its behavior accordingly.</p> </div> </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="create-a-mysql-user-for-the-connector">Create a MySQL user for the connector</h3> <div class="paragraph"> <p>A MySQL user must be defined that has all of the following permissions on all of the databases that the connector will monitor:</p> </div> <div class="ulist"> <ul> <li> <p><a href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_select"><code>SELECT</code></a> - enables the connector to select rows from tables in databases; used only when performing a snapshot</p> </li> <li> <p><a href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_reload"><code>RELOAD</code></a> - enables the connector of the <a href="http://dev.mysql.com/doc/refman/5.7/en/flush.html"><code>FLUSH</code></a> statement to clear or reload various internal caches, flush tables, or acquire locks; used only when performing a snapshot</p> </li> <li> <p><a href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_show-databases"><code>SHOW DATABASES</code></a> - enables the connector to see database names by issuing the <code>SHOW DATABASE</code> statement; used only when performing a snapshot</p> </li> <li> <p><a href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-slave"><code>REPLICATION SLAVE</code></a> - enables the connector to connect to and read the binlog of its MySQL server; always required for the connector</p> </li> <li> <p><a href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-client"><code>REPLICATION CLIENT</code></a> - enables the use of <code>SHOW MASTER STATUS</code>, <code>SHOW SLAVE STATUS</code>, and <code>SHOW BINARY LOGS</code>; always required for the connector</p> </li> </ul> </div> <div class="paragraph"> <p>For example, the following statement grants these permissions for a user <code>debezium</code> that authenticates with the password <code>dbz</code>, where the user can be on any machine:</p> </div> <div class="literalblock"> <div class="content"> <pre>GRANT SELECT, RELOAD, SHOW DATABASES, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'debezium' IDENTIFIED BY 'dbz';</pre> </div> </div> <div class="admonitionblock warning"> <table> <tr> <td class="icon"> <i class="fa icon-warning" title="Warning"></i> </td> <td class="content"> <div class="paragraph"> <p>Choose a good password that is different from what we use above.</p> </div> <div class="paragraph"> <p>Also, the above grant is equivalent to specifying any authenticating client on <em>any</em> hosts, so obviously this is not recommended for production. Instead, in production you would almost certainly limit the replication user to the machine(s) where the MySQL connector is running within a Kafka Connect service, such as <code>&#8230;&#8203; 'debezium'@'connect.host.acme.com' &#8230;&#8203;</code>.</p> </div> </td> </tr> </table> </div> </div> </div> </div> <div class="sect1"> <h2 id="supported-mysql-topologies">Supported MySQL topologies</h2> <div class="sectionbody"> <div class="paragraph"> <p>The MySQL connector can be used with a variety of MySQL topologies.</p> </div> <div class="sect2"> <h3 id="mysql-standalone">MySQL standalone</h3> <div class="paragraph"> <p>When a single MySQL server is used by itself, then that server must have the binlog enabled (and optionally GTIDs enabled) so that the MySQL connector can be able to monitor it. This is often acceptable, since the binary log can also be used as an <a href="http://dev.mysql.com/doc/refman/5.7/en/backup-methods.html">incremental backup</a>. In this case, the MySQL connector will always connect to and follow this standalone MySQL server instance.</p> </div> </div> <div class="sect2"> <h3 id="mysql-master-and-slave">MySQL master and slave</h3> <div class="paragraph"> <p><a href="http://dev.mysql.com/doc/refman/5.7/en/replication-solutions.html">MySQL replication</a> can be used to set up a cluster of MySQL instances, where one of the MySQL server instances is considered the <em>master</em> and the other(s) a <em>slave</em>. Topologies can include single master with single slave, single master with multiple slaves, and multiple masters with multiple slaves. Which you choose will depend on your requirements, your backup and recovery strategy, and how you are scaling MySQL to handle large data volumes and queries.</p> </div> <div class="paragraph"> <p>To use the MySQL connector with one of these topologies, the connector can follow one of the masters or one of the slaves (if that slave has its binlog enabled), but the connector will see only those changes in the cluster that are visible to that server. Generally, this is not a problem except for the multi-master topologies.</p> </div> <div class="paragraph"> <p>The connector records its position in the server&#8217;s binlog, which is different on each server in the cluster. Therefore, the connector will need to follow just one MySQL server instance. If that server fails, it must be restarted or recovered before the connector can continue.</p> </div> </div> <div class="sect2"> <h3 id="highly-available-mysql-clusters">Highly Available MySQL clusters</h3> <div class="paragraph"> <p>A <a href="https://dev.mysql.com/doc/mysql-ha-scalability/en/">variety of high availability solutions</a> exist for MySQL, and they make it far easier to tolerate and almost immediately recover from problems and failures. Most HA MySQL clusters use GTIDs so that slaves are able to keep track of all changes on any of the master.</p> </div> <div class="paragraph"> <p>Using the MySQL connector with a highly-available MySQL cluster is now possible with Debezium 0.2, as long as GTIDs are enabled in the MySQL cluster. When this is the case, the MySQL connector can connect to any of the servers that have a binlog enabled, and upon startup the connector uses the GTIDs to identify where in that server&#8217;s binlog it should begin reading.</p> </div> <div class="paragraph"> <p>When the cluster is fronted by a load balancer with a single hostname, the connector can be configured to connect using that host. Upon startup, the connector establishes a connection with one of the load balanced servers, and continues to use it until the connector is stopped/rebalanced or until communication fails. At that point, the connector need only be restarted, and it will connect to one of the servers in the cluster and continue reading the binlog.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="how-the-mysql-connector-works">How the MySQL connector works</h2> <div class="sectionbody"> <div class="paragraph"> <p>This section goes into detail about how the MySQL connector tracks the structure of the tables, performs snapshots, transform binlog events into Debezium change events, where those events are recorded in Kafka, and how the connector behaves when things go wrong.</p> </div> <div class="sect2"> <h3 id="database-schema-history">Database schema history</h3> <div class="paragraph"> <p>When a database client queries a database, it uses the database&#8217;s current schema. However, the database schema can be changed at any time, which means that the connector must know what the schema looked like at the time each insert, update, or delete operation is <em>recorded</em>. It can&#8217;t just use the current schema, either, since it may be processing events that are relatively old and may have been recorded before the tables' schemas were changed. Luckily, MySQL includes in the binlog the row-level changes to the data <em>and</em> the DDL statements that are applied to the database. As the connector reads the binlog and comes across these DDL statements, it parses them and updates an in-memory representation of each table&#8217;s schema, which is then used to understand the structure of the tables at the time each insert, update, or delete occurs and to produce the appropriate change event. It also records in a separate <em>database history</em> Kafka topic all of the DDL statements along with the position in the binlog where each DDL statement appeared.</p> </div> <div class="paragraph"> <p>When the connector restarts after having crashed or been stopped gracefully, the connector will start reading the binlog from a specific position (i.e., a specific point in time). The connector rebuilds the table structures that existed <em>at this point in time</em> by reading the database history Kafka topic and parsing all DDL statements up until the point in the binlog where the connector is starting.</p> </div> <div class="paragraph"> <p>This database history topic is for connector use only, but the connector can optionally generate <em>schema change events</em> on a different topic that is intended for consumer applications. We&#8217;ll cover this in the <a href="#schema-change-topic">Schema Change Topic</a> section.</p> </div> </div> <div class="sect2"> <h3 id="snapshots">Snapshots</h3> <div class="paragraph"> <p>When a MySQL connector that is configured to follow a MySQL server instance is first started, it will by default perform an initial <em>consistent snapshot</em> of a database. This is the default mode, since much of the time the MySQL binlogs no longer contain the complete history of the database.</p> </div> <div class="paragraph"> <p>The connector performs the following steps each time it takes a snapshot:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Start a transaction with <a href="https://dev.mysql.com/doc/refman/5.6/en/innodb-consistent-read.html"><em>repeatable read</em> semantics</a> to ensure that all subsequent reads within this transaction are done against a single consistent snapshot.</p> </li> <li> <p>Grab a global read lock that blocks writes by other database clients.</p> </li> <li> <p>Read the current position of the binlog.</p> </li> <li> <p>Read the schema of the databases and tables allowed by the connector&#8217;s configuration.</p> </li> <li> <p>Release the global read lock, allowing other DB clients to again write to the database</p> </li> <li> <p>Optionally write the DDL changes to the <em>schema change topic</em>, including all necessary <code>DROP &#8230;&#8203;</code> and <code>CREATE &#8230;&#8203;</code> DDL statements</p> </li> <li> <p>Scans all of the database tables and generates on the appropriate table-specific Kafka topics <code>CREATE</code> events for each row.</p> </li> <li> <p>Commit the transaction.</p> </li> <li> <p>Record in the connector offsets that the connector successfully completed the snapsho.</p> </li> </ol> </div> <div class="paragraph"> <p>If the connector fails, is rebalanced, or stops before the snapshot is complete, the connector will begin a new snapshot when it is restarted. Once the connector does complete its initial snapshot, the MySQL connector then proceeds to read the binlog from the position read during step 3, ensuring that the connector does not miss any updates. If the connector stops again for any reason, upon restart it will simply continue reading the binlog where it previously left off. However, if the connector remains stopped for long enough, MySQL might purge older binlog files and the connector&#8217;s last position may be lost. In this case, when the connector configured with <em>initial</em> snapshot mode (the default) is finally restarted, the MySQL server will no longer have the starting point and the connector will fail with an error.</p> </div> <div class="paragraph"> <p>A second snapshot mode allows the connector to perform snapshots <em>whenever necessary</em>. This behavior is similar to the default <em>initial</em> snapshot behavior mentioned above, except with one exception: if the connector is restarted <em>and</em> MySQL no longer has its starting point in the binlog, rather than failing the connector will instead perform another snapshot. This mode is perhaps the most automated, but at the risk of performing additional snapshots when things go wrong (generally when the connector is down too long).</p> </div> <div class="paragraph"> <p>The third snapshot mode ensures the connector <em>never</em> performs snapshots. When a new connector is configured this way, it will start reading the binlog from the beginning. This is not the default behavior because starting a new connector in this mode (without a snapshot) requires the MySQL binlog contain the entire history of all monitored databases, and MySQL instances are rarely configured this way. Specifically, the binlog must contain at least the <code>CREATE TABLE &#8230;&#8203;</code> statement for every monitored table. If this requirement is not satisfied, the connector will not be able to properly interpret the structure of the low-level events in the binlog, and it will simply skip all events for those missing table definitions. (The connector cannot rely upon the current definition of those tables, since the tables may have been altered after the initial events were recorded in the binlog, preventing the connector from properly interpreting the binlog events.)</p> </div> <div class="paragraph"> <p>Because of how the connector records offsets when performing a snapshot, the connector now defaults to <code>include.schema.events=true</code>. This writes all DDL changes performed during a snapshot to a topic that can be consumed by apps. And, more importantly, during the final step mentioned above it ensures that the updated offsets are recorded immediately (rather than waiting until a database change occurs).</p> </div> </div> <div class="sect2"> <h3 id="reading-the-binlog">Reading the MySQL binlog</h3> <div class="paragraph"> <p>The MySQL connector will typically spend the vast majority of its time reading the binlog of the MySQL server to which it is connected.</p> </div> <div class="paragraph"> <p>As the MySQL connector reads the binlog, it transforms the binary log events into Debezium <em>create</em>, <em>update</em>, or <em>delete</em> events that include the position in the binlog (including GTIDs if they are used) where the event was found. The MySQL connector forwards these change events to the Kafka Connect framework (running in the same process), which then synchronously writes them to the appropriate Kafka topic. Kafka Connect uses the term <em>offset</em> for the source-specific position information that Debezium includes with each event, and Kafka Connect periodically records the most recent offset in another Kafka topic.</p> </div> <div class="paragraph"> <p>When Kafka Connect gracefully shuts down, it stops the connectors, flushes all events to Kafka, and records the last offset received from each connector. Upon restart, Kafka Connect reads the last recorded offset for each connector, and starts the connector from that point. The MySQL connector uses the binlog filename, the position in that file, and the GTIDs (if they are enabled in MySQL server) recorded in its offset to request that MySQL send it the binlog events starting just after that position.</p> </div> </div> <div class="sect2"> <h3 id="topic-names">Topics names</h3> <div class="paragraph"> <p>The MySQL connector writes events for all insert, update, and delete operations on a single table to a single Kafka topic. The name of the Kafka topics always takes the form <em>serverName</em>.<em>databaseName</em>.<em>tableName</em>, where <em>serverName</em> is the logical name of the connector as specified with the <code>database.server.name</code> configuration property, <em>databaseName</em> is the name of the database where the operation occurred, and <em>tableName</em> is the name of the database table on which the operation occurred.</p> </div> <div class="paragraph"> <p>For example, consider a MySQL installation with an <code>inventory</code> database that contains four tables: <code>products</code>, <code>products_on_hand</code>, <code>customers</code>, and <code>orders</code>. If the connector monitoring this database were given a logical server name of <code>fulfillment</code>, then the connector would produce events on these four Kafka topics:</p> </div> <div class="ulist"> <ul> <li> <p><code>fulfillment.inventory.products</code></p> </li> <li> <p><code>fulfillment.inventory.products_on_hand</code></p> </li> <li> <p><code>fulfillment.inventory.customers</code></p> </li> <li> <p><code>fulfillment.inventory.orders</code></p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="schema-change-topic">Schema change topic</h3> <div class="paragraph"> <p>The connector can produce <em>schema change events</em> that contain all of the DDL statements applied to databases in the MySQL server. When enabled, the connector writes all such events to a Kafka topic named <em>serverName</em>, where <em>serverName</em> is the logical name of the connector as specified with the <code>database.server.name</code> configuration property. In our previous example where the logical server name is <code>fulfillment</code>, the schema change events would be recorded in the topic <code>fulfillment</code>.</p> </div> <div class="admonitionblock important"> <table> <tr> <td class="icon"> <i class="fa icon-important" title="Important"></i> </td> <td class="content"> <div class="paragraph"> <p>Like the <a href="#database-schema-history">database history topic</a>, the schema change topic does contain events with the DDL statement. Be sure to use the <em>schema change topic</em>, and never consume the database history topic.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>Each message written to the schema change topic will have a message key that contains the name of the database to which the client was connected and using when they applied the DDL statement(s):</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-json" data-lang="json">{&#x000A;  "schema": {&#x000A;    "type": "struct",&#x000A;    "name": "io.debezium.connector.mysql.SchemaChangeKey"&#x000A;    "optional": false,&#x000A;    "fields": [&#x000A;      {&#x000A;        "field": "databaseName",&#x000A;        "type": "string",&#x000A;        "optional": false&#x000A;      }&#x000A;    ]&#x000A;  },&#x000A;  "payload": {&#x000A;    "databaseName": "inventory"&#x000A;  }&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>Meanwhile, the schema change event message&#8217;s value will contain a structure containing the DDL statement(s), the database to which the statements were <em>applied</em>, and the position in the binlog where the statement(s) appeared:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-json" data-lang="json">{&#x000A;  "schema": {&#x000A;    "type": "struct",&#x000A;    "name": "io.debezium.connector.mysql.SchemaChangeValue"&#x000A;    "optional": false,&#x000A;    "fields": [&#x000A;      {&#x000A;        "field": "databaseName",&#x000A;        "type": "string",&#x000A;        "optional": false&#x000A;      },&#x000A;      {&#x000A;        "field": "ddl",&#x000A;        "type": "string",&#x000A;        "optional": false&#x000A;      },&#x000A;      {&#x000A;        "field": "source",&#x000A;        "type": "struct",&#x000A;        "name": "io.debezium.connector.mysql.Source",&#x000A;        "optional": false,&#x000A;        "fields": [&#x000A;          {&#x000A;            "type": "string",&#x000A;            "optional": false,&#x000A;            "field": "name"&#x000A;          },&#x000A;          {&#x000A;            "type": "int64",&#x000A;            "optional": false,&#x000A;            "field": "server_id"&#x000A;          },&#x000A;          {&#x000A;            "type": "int64",&#x000A;            "optional": false,&#x000A;            "field": "ts_sec"&#x000A;          },&#x000A;          {&#x000A;            "type": "string",&#x000A;            "optional": true,&#x000A;            "field": "gtid"&#x000A;          },&#x000A;          {&#x000A;            "type": "string",&#x000A;            "optional": false,&#x000A;            "field": "file"&#x000A;          },&#x000A;          {&#x000A;            "type": "int64",&#x000A;            "optional": false,&#x000A;            "field": "pos"&#x000A;          },&#x000A;          {&#x000A;            "type": "int32",&#x000A;            "optional": false,&#x000A;            "field": "row"&#x000A;          },&#x000A;          {&#x000A;            "type": "boolean",&#x000A;            "optional": true,&#x000A;            "field": "snapshot"&#x000A;          }&#x000A;        ]&#x000A;      }&#x000A;    ]&#x000A;  },&#x000A;  "payload": {&#x000A;    "databaseName": "inventory",&#x000A;    "ddl": "CREATE TABLE products ( id INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY, name VARCHAR(255) NOT NULL, description VARCHAR(512), weight FLOAT ); ALTER TABLE products AUTO_INCREMENT = 101;",&#x000A;    "source" : {&#x000A;      "name": "mysql-server-1",&#x000A;      "server_id": 0,&#x000A;      "ts_sec": 0,&#x000A;      "gtid": null,&#x000A;      "file": "mysql-bin.000003",&#x000A;      "pos": 154,&#x000A;      "row": 0,&#x000A;      "snapshot": true&#x000A;    }&#x000A;  }&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>The <code>ddl</code> field may contain multiple DDL statements, but every statement in the event will apply to the database named in the <code>databaseName</code> field and they will appear in the same order as applied to the database. Additionally, all of the events in the schema change topic will appear in the same order as applied to the MySQL server.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="paragraph"> <p>The <code>source</code> field is the exact same structure that appears in normal data change events written to table-specific topics. You can use the contents of this field to correlate the events on different topics.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>As mentioned above, each schema change event will contain one or more DDL statements that apply to a single database. What happens if a client submits a series of DDL statements that apply to <em>multiple</em> databases (e.g., perhaps they use fully-qualified names)? If MySQL applies those statements atomically (e.g., as a single transaction), then the connector will take those DDL statements <em>in order</em>, group them by the affected database, and then create a schema change event for each of those groups. On the other hand, if MySQL applies those statements individually, then the connector will create a separate schema change event for each statement.</p> </div> </div> <div class="sect2"> <h3 id="events">Events</h3> <div class="paragraph"> <p>All data change events produced by the MySQL connector have a key and a value, although the structure of the key and value depend on the table from which the change events originated (see <a href="#topic-names">Topic Names</a>).</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>Starting with Kafka 0.10, Kafka can optionally record with the message key and value the <a href="http://kafka.apache.org/documentation.html#upgrade_10_performance_impact"><em>timestamp</em></a> at which the message was created (recorded by the producer) or written to the log by Kafka.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>Debezium and Kafka Connect are designed around <em>continuous streams of event messages</em>, and the structure of these events may change over time. This could be difficult for consumers to deal with, so to make it very easy Kafka Connect makes each event self-contained. Every message key and value has two parts: a <em>schema</em> and <em>payload</em>. The schema describes the structure of the payload, while the payload contains the actual data.</p> </div> <div class="sect3"> <h4 id="change-events-key">Change event&#8217;s key</h4> <div class="paragraph"> <p>For a given table, the change event&#8217;s key will have a structure that contains a field for each column in the primary key (or unique key constraint) of the table at the time the event was created. Consider an <code>inventory</code> database with a <code>customers</code> table defined as:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">CREATE TABLE customers (&#x000A;  id INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,&#x000A;  first_name VARCHAR(255) NOT NULL,&#x000A;  last_name VARCHAR(255) NOT NULL,&#x000A;  email VARCHAR(255) NOT NULL UNIQUE KEY&#x000A;) AUTO_INCREMENT=1001;</code></pre> </div> </div> <div class="paragraph"> <p>Every change event for the <code>customers</code> table while it has this definition will feature the same key structure, which in JSON looks like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-json" data-lang="json">{&#x000A;  "schema": {&#x000A;    "type": "struct",&#x000A;    "name": "mysql-server-1.inventory.customers.Key"&#x000A;    "optional": false,&#x000A;    "fields": [&#x000A;      {&#x000A;        "field": "id",&#x000A;        "type": "int32",&#x000A;        "optional": false&#x000A;      }&#x000A;    ]&#x000A;  },&#x000A;  "payload": {&#x000A;    "id": 1001&#x000A;  }&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>The <code>schema</code> portion of the key contains a Kafka Connect schema describing what is in the payload portion, and in our case that means that the <code>payload</code> value is not optional, is a structure defined by a schema named <code>mysql-server-1.inventory.customers.Key</code>, and has one required field named <code>id</code> of type <code>int32</code>. If we look at the value of the key&#8217;s <code>payload</code> field, we&#8217;ll see that it is indeed a structure (which in JSON is just an object) with a single <code>id</code> field, whose value is <code>1004</code>.</p> </div> <div class="paragraph"> <p>Therefore, we interpret this key as describing the row in the <code>inventory.customers</code> table (output from the connector named <code>mysql-server-1</code>) whose <code>id</code> primary key column had a value of <code>1004</code>.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>Although the <code>column.blacklist</code> configuration property allows you to remove columns from the event values, all columns in a primary or unique key are always included in the event&#8217;s key.</p> </div> </td> </tr> </table> </div> <div class="admonitionblock warning"> <table> <tr> <td class="icon"> <i class="fa icon-warning" title="Warning"></i> </td> <td class="content"> <div class="paragraph"> <p>If the table does not have a primary or unique key, then the change event&#8217;s key will be null. This makes sense since the rows in a table without a primary or unique key constraint cannot be uniquely identified.</p> </div> </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="change-events-value">Change event&#8217;s value</h4> <div class="paragraph"> <p>The value of the change event message is a bit more complicated. Like the key message, it has a <em>schema</em> section and <em>payload</em> section. Starting with Debezium 0.2, the payload section of every change event value produced by the MySQL connector has an <em>envelope</em> structure with the following fields:</p> </div> <div class="ulist"> <ul> <li> <p><code>op</code> is a mandatory field that contains a string value describing the type of operation. Values for the MySQL connector are <code>c</code> for create (or insert), <code>u</code> for update, <code>d</code> for delete, and <code>r</code> for read (in the case of a non-initial snapshot).</p> </li> <li> <p><code>before</code> is an optional field that if present contains the state of the row <em>before</em> the event occurred. The structure will be described by the <code>mysql-server-1.inventory.customers.Value</code> Kafka Connect schema, which the <code>mysql-server-1</code> connector uses for all rows in the <code>inventory.customers</code> table.</p> </li> <li> <p><code>after</code> is an optional field that if present contains the state of the row <em>after</em> the event occurred. The structure is describe by the same <code>mysql-server-1.inventory.customers.Value</code> Kafka Connect schema used in <code>before</code>.</p> </li> <li> <p><code>source</code> is a mandatory field that conains a structure describing the source metadata for the event, which in the case of MySQL contains several fields: the connector name, the name of the binlog file where the event was recorded, the position in that binlog file where the event appeared, the row within the event (if there is more than one), whether this event was part of a snapshot, and if available the MySQL server ID, and the timestamp in seconds.</p> </li> <li> <p><code>ts_ms</code> is optional and if present contains the time (using the system clock in the JVM running the Kafka Connect task) at which the connector processed the event.</p> </li> </ul> </div> <div class="paragraph"> <p>And of course, the <em>schema</em> portion of the event message&#8217;s value contains a schema that decribes tihs envelope structure and the nested fields within it.</p> </div> <div class="paragraph"> <p>Let&#8217;s look at what a <em>create</em> event value might look like for our <code>customers</code> table:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-json" data-lang="json">{&#x000A;    "schema": {&#x000A;      "type": "struct",&#x000A;      "optional": false,&#x000A;      "name": "mysql-server-1.inventory.customers.Envelope",&#x000A;      "version": 1,&#x000A;      "fields": [&#x000A;        {&#x000A;          "field": "op",&#x000A;          "type": "string",&#x000A;          "optional": false&#x000A;        },&#x000A;        {&#x000A;          "field": "before",&#x000A;          "type": "struct",&#x000A;          "optional": true,&#x000A;          "name": "mysql-server-1.inventory.customers.Value",&#x000A;          "fields": [&#x000A;            {&#x000A;              "type": "int32",&#x000A;              "optional": false,&#x000A;              "field": "id"&#x000A;            },&#x000A;            {&#x000A;              "type": "string",&#x000A;              "optional": false,&#x000A;              "field": "first_name"&#x000A;            },&#x000A;            {&#x000A;              "type": "string",&#x000A;              "optional": false,&#x000A;              "field": "last_name"&#x000A;            },&#x000A;            {&#x000A;              "type": "string",&#x000A;              "optional": false,&#x000A;              "field": "email"&#x000A;            }&#x000A;          ]&#x000A;        },&#x000A;        {&#x000A;          "field": "after",&#x000A;          "type": "struct",&#x000A;          "name": "mysql-server-1.inventory.customers.Value",&#x000A;          "optional": true,&#x000A;          "fields": [&#x000A;            {&#x000A;              "type": "int32",&#x000A;              "optional": false,&#x000A;              "field": "id"&#x000A;            },&#x000A;            {&#x000A;              "type": "string",&#x000A;              "optional": false,&#x000A;              "field": "first_name"&#x000A;            },&#x000A;            {&#x000A;              "type": "string",&#x000A;              "optional": false,&#x000A;              "field": "last_name"&#x000A;            },&#x000A;            {&#x000A;              "type": "string",&#x000A;              "optional": false,&#x000A;              "field": "email"&#x000A;            }&#x000A;          ]&#x000A;        },&#x000A;        {&#x000A;          "field": "source",&#x000A;          "type": "struct",&#x000A;          "name": "io.debezium.connector.mysql.Source",&#x000A;          "optional": false,&#x000A;          "fields": [&#x000A;            {&#x000A;              "type": "string",&#x000A;              "optional": false,&#x000A;              "field": "name"&#x000A;            },&#x000A;            {&#x000A;              "type": "int64",&#x000A;              "optional": false,&#x000A;              "field": "server_id"&#x000A;            },&#x000A;            {&#x000A;              "type": "int64",&#x000A;              "optional": false,&#x000A;              "field": "ts_sec"&#x000A;            },&#x000A;            {&#x000A;              "type": "string",&#x000A;              "optional": true,&#x000A;              "field": "gtid"&#x000A;            },&#x000A;            {&#x000A;              "type": "string",&#x000A;              "optional": false,&#x000A;              "field": "file"&#x000A;            },&#x000A;            {&#x000A;              "type": "int64",&#x000A;              "optional": false,&#x000A;              "field": "pos"&#x000A;            },&#x000A;            {&#x000A;              "type": "int32",&#x000A;              "optional": false,&#x000A;              "field": "row"&#x000A;            },&#x000A;            {&#x000A;              "type": "boolean",&#x000A;              "optional": true,&#x000A;              "field": "snapshot"&#x000A;            }&#x000A;          ]&#x000A;        },&#x000A;        {&#x000A;          "field": "ts_ms",&#x000A;          "type": "int64",&#x000A;          "optional": true&#x000A;        }&#x000A;      ]&#x000A;    },&#x000A;    "payload": {&#x000A;      "op": "c",&#x000A;      "ts_ms": 1465491411815,&#x000A;      "before": null,&#x000A;      "after": {&#x000A;        "id": 1004,&#x000A;        "first_name": "Anne",&#x000A;        "last_name": "Kretchmar",&#x000A;        "email": "annek@noanswer.org"&#x000A;      },&#x000A;      "source": {&#x000A;        "name": "mysql-server-1",&#x000A;        "server_id": 0,&#x000A;        "ts_sec": 0,&#x000A;        "gtid": null,&#x000A;        "file": "mysql-bin.000003",&#x000A;        "pos": 154,&#x000A;        "row": 0,&#x000A;        "snapshot": true&#x000A;      }&#x000A;    }&#x000A;  }</code></pre> </div> </div> <div class="paragraph"> <p>If we look at the <code>schema</code> portion of this event&#8217;s <em>value</em>, we can see the schema for the <em>envelope</em>, the schema for the <code>source</code> structure (which is specific to the MySQL connector and reused across all events), and the table-specific schemas for the <code>before</code> and <code>after</code> fields.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="paragraph"> <p>The names of the schemas for the <code>before</code> and <code>after</code> fields are of the form "<em>logicalName</em>.<em>tableName</em>.Value", and thus are entirely independent from all other schemas for all other tables. This means that when using the <a href="/docs/faq#avro-converter">Avro Converter</a>, the resulting Avro schems for <em>each table</em> in each <em>logical source</em> have their own evolution and history.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>If we look at the <code>payload</code> portion of this event&#8217;s <em>value</em>, we can see the information in the event, namely that it is describing that the row was created (since <code>op=c</code>), and that the <code>after</code> field value contains the values of the new inserted row&#8217;s' <code>id</code>, <code>first_name</code>, <code>last_name</code>, and <code>email</code> columns.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="paragraph"> <p>It may appear that the JSON representations of the events are much larger than the rows they describe. This is true, because the JSON representation must include the <em>schema</em> and the <em>payload</em> portions of the message. It is possible and even recommended to use the <a href="/docs/faq#avro-converter">Avro Converter</a> to dramatically decrease the size of the actual messages written to the Kafka topics.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>The value of an <em>update</em> change event on this table will actually have the exact same <em>schema</em>, and its payload will be structured the same but will hold different values. Here&#8217;s an example:</p> </div> <div class="paragraph"> <p>Here&#8217;s that new event&#8217;s <em>value</em> formatted to be easier to read:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-json" data-lang="json">{&#x000A;    "schema": { ... },&#x000A;    "payload": {&#x000A;      "before": {&#x000A;        "id": 1004,&#x000A;        "first_name": "Anne",&#x000A;        "last_name": "Kretchmar",&#x000A;        "email": "annek@noanswer.org"&#x000A;      },&#x000A;      "after": {&#x000A;        "id": 1004,&#x000A;        "first_name": "Anne Marie",&#x000A;        "last_name": "Kretchmar",&#x000A;        "email": "annek@noanswer.org"&#x000A;      },&#x000A;      "source": {&#x000A;        "name": "mysql-server-1",&#x000A;        "server_id": 223344,&#x000A;        "ts_sec": 1465581,&#x000A;        "gtid": null,&#x000A;        "file": "mysql-bin.000003",&#x000A;        "pos": 484,&#x000A;        "row": 0,&#x000A;        "snapshot": null&#x000A;      },&#x000A;      "op": "u",&#x000A;      "ts_ms": 1465581029523&#x000A;    }</code></pre> </div> </div> <div class="paragraph"> <p>When we compare this to the value in the <em>insert</em> event, we see a couple of differences in the <code>payload</code> section:</p> </div> <div class="ulist"> <ul> <li> <p>The <code>op</code> field value is now <code>u</code>, signifying that this row changed because of an update</p> </li> <li> <p>The <code>before</code> field now has the state of the row with the values before the database commit</p> </li> <li> <p>The <code>after</code> field now has the updated state of the row, and here was can see that the <code>first_name</code> value is now <code>Anne Marie</code>.</p> </li> <li> <p>The <code>source</code> field structure has the same fields as before, but the values are different since this event is from a different position in the binlog.</p> </li> <li> <p>The <code>ts_ms</code> shows the timestamp that Debezium processed this event.</p> </li> </ul> </div> <div class="paragraph"> <p>There are several things we can learn by just looking at this <code>payload</code> section. We can compare the <code>before</code> and <code>after</code> structures to determine what actually changed in this row because of the commit. The <code>source</code> structure tells us information about MySQL&#8217;s record of this change (providing traceability), but more importantly this has information we can compare to other events in this and other topics to know whether this event occurred before, after, or as part of the same MySQL commit as other events.</p> </div> <div class="paragraph"> <p>So far we&#8217;ve seen samples of <em>create</em> and <em>update</em> events. Now, let&#8217;s look at the value of a <em>delete</em> event for the same table. Once again, the <code>schema</code> portion of the value will be exactly the same as with the <em>create</em> and <em>update</em> events:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-json" data-lang="json">{&#x000A;    "schema": { ... },&#x000A;    "payload": {&#x000A;      "before": {&#x000A;        "id": 1004,&#x000A;        "first_name": "Anne Marie",&#x000A;        "last_name": "Kretchmar",&#x000A;        "email": "annek@noanswer.org"&#x000A;      },&#x000A;      "after": null,&#x000A;      "source": {&#x000A;        "name": "mysql-server-1",&#x000A;        "server_id": 223344,&#x000A;        "ts_sec": 1465581,&#x000A;        "gtid": null,&#x000A;        "file": "mysql-bin.000003",&#x000A;        "pos": 805,&#x000A;        "row": 0,&#x000A;        "snapshot": null&#x000A;      },&#x000A;      "op": "d",&#x000A;      "ts_ms": 1465581902461&#x000A;    }</code></pre> </div> </div> <div class="paragraph"> <p>If we look at the <code>payload</code> portion, we see a number of differences compared with the <em>create</em> or <em>update</em> event payloads:</p> </div> <div class="ulist"> <ul> <li> <p>The <code>op</code> field value is now <code>d</code>, signifying that this row was deleted</p> </li> <li> <p>The <code>before</code> field now has the state of the row that was deleted with the database commit</p> </li> <li> <p>The <code>after</code> field is null, signifying that the row no longer exists</p> </li> <li> <p>The <code>source</code> field structure has many of the same values as before, except the <code>ts_sec</code> and <code>pos</code> fields have changed (and the <code>file</code> might have changed in other circumstances).</p> </li> <li> <p>The <code>ts_ms</code> shows the timestamp that Debezium processed this event.</p> </li> </ul> </div> <div class="paragraph"> <p>This event gives a consumer all kinds of information that it can use to process the removal of this row. We include the old values so that some consumers might require them in order to properly handle the removal, and without it they may have to resort to far more complex behavior.</p> </div> <div class="paragraph"> <p>The MySQL connector&#8217;s events are designed to work with <a href="https://cwiki.apache.org/confluence/display/KAFKA/Log+Compaction">Kafka log compaction</a>, which allows for the removal of some older messages as long as at least the most recent message for every key is kept. This allows Kafka to reclaim storage space while ensuring the topic contains a complete dataset and can be used for reloading key-based state.</p> </div> <div class="paragraph"> <p>When a row is deleted, the <em>delete</em> event value listed above still works with log compaction, since Kafka can still remove all earlier messages with that same key. But only if the message value is null will Kafka know that it can remove <em>all messages</em> with that same key. To make this possible, Debezium&#8217;s MySQL connector always follows <em>delete</em> event with a special <em>tombstone</em> event that has the same key but null value.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>As of Kafka 0.10, the JSON converter provided by Kafka Connect never results in a null value for the message (<a href="https://issues.apache.org/jira/browse/KAFKA-3832">KAFKA-3832</a>). Therefore, Kafka&#8217;s log compaction will always retain the last message, even when the tombstone event is supplied, though it will be free to remove all prior messages with the same key. In other words, until this is fixed using the JSON Converter will reduce the effectiveness of Kafka&#8217;s log compaction.</p> </div> <div class="paragraph"> <p>In the meantime, consider using the <a href="/docs/faq#avro-converter">Avro Converter</a>, which does properly return a null value and will thus take full advantage of Kafka log compaction.</p> </div> </td> </tr> </table> </div> </div> </div> <div class="sect2"> <h3 id="when-things-go-wrong">When things go wrong</h3> <div class="paragraph"> <p>Debezium is a distributed system that captures all changes in multiple upstream databases, and will never miss or lose an event. Of course, when the system is operating nominally or being administered carefully, then Debezium provides <em>exactly once</em> delivery of every change event. However, if a fault does happen then the system will still not lose any events, although while it is recovering from the fault it may repeat some change events. Thus, in these abnormal situations Debezium provides <em>at least once</em> delivery of change events.</p> </div> <div class="paragraph"> <p>The rest of this section describes how Debezium handles various kinds of faults and problems.</p> </div> <div class="sect3"> <h4 id="_configuration_and_startup_errors">Configuration and startup errors</h4> <div class="paragraph"> <p>The connector will fail upon startup, report an error/exception in the log, and stop running when the connector&#8217;s configuration is invalid, when the connector cannot successfully connect to MySQL using the specified connectivity parameters, or when the connector is restarting from a previously-recorded position in the MySQL history (via binlog coordinates or GTID set) and MySQL no longer has that history available.</p> </div> <div class="paragraph"> <p>In these cases, the error will have more details about the problem and possibly a suggested work around. The connector can be restarted when the configuration has been corrected or the MySQL problem has been addressed.</p> </div> </div> <div class="sect3"> <h4 id="_mysql_becomes_unavailable">MySQL becomes unavailable</h4> <div class="paragraph"> <p>Once the connector is running, if the MySQL server it has been connected to becomes unavailable for any reason, the connector will fail with an error and the connector will stop. Simply restart the connector when the server is available.</p> </div> <div class="paragraph"> <p>Note that when using GTIDs and a highly available MySQL cluster, you can simply restart the connector immediately, and the connector will connect to a different MySQL server in the cluster, find the location in that server&#8217;s binlog that represents the last transaction that was processed completely, and start reading the new server&#8217;s binlog from that location.</p> </div> <div class="paragraph"> <p>When the connector and MySQL are not using GTIDs, the connector records the position within the specific binlog of the MySQL server to which it is connected. These binlog coordinates are only valid on that MySQL server, so to recover the connector must do so only by connecting to that server (or to another server that has been recovered from backups of the MySQL server).</p> </div> </div> <div class="sect3"> <h4 id="_kafka_connect_process_stops_gracefully">Kafka Connect process stops gracefully</h4> <div class="paragraph"> <p>If Kafka Connect is being run in distributed mode, and a Kafka Connect process is stopped gracefullly, then prior to shutdown of that processes Kafka Connect will migrate all of the process' connector tasks to another Kafka Connect process in that group, and the new connector tasks will pick up exactly where the prior tasks left off. There will be a short delay in processing while the connector tasks are stopped gracefully and restarted on the new processes.</p> </div> </div> <div class="sect3"> <h4 id="_kafka_connect_process_crashes">Kafka Connect process crashes</h4> <div class="paragraph"> <p>If the Kafka Connector process stops unexpectedly, then any connector tasks it was running will obviously terminate without recording their most recently-processed offsets. When Kafka Connect is being run in distributed mode, it will restart those connector tasks on other processes. However, the MySQL connectors will resume from the last offset recorded by the earlier processes, which means that the new replacement tasks may generate some of the same change events that were processed just prior to the crash. The number of duplicate events will depend on the offset flush period and the volume of data changes just before the crash.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="paragraph"> <p>Because there is a chance that some events may be duplicated during a recovery from failure, consumers should always anticipate some events may be duplicated. Although Debezium change events are strictly speaking not idempotent, the <em>state</em> within the events can be used by consumuers in an idempotent way. For example, many consumers might treat <em>create events</em> and <em>update events</em> in a similar way by simply using the <code>after</code> state, so seeing a duplicate <em>create event</em> is simply handled as sequential updates.</p> </div> <div class="paragraph"> <p>Debezium also includes with each change event message the source-specific information about the origin of the event, including the MySQL server&#8217;s time of the event, its binlog filename and position, and GTID (if used). Consumers can keep track of this information (especially GTIDs) to know whether it has already seen a particular event.</p> </div> </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="_kafka_becomes_unavailable">Kafka becomes unavailable</h4> <div class="paragraph"> <p>As the connector generates change events, the Kafka Connect framework records those events in Kafka using the Kafka producer API. Kafka Connect will also periodically record the latest offset that appears in those change events, at a frequency you&#8217;ve specified in the Kakfa Connect worker configuration. If the Kafka brokers become unavailable, the Kafka Connect worker process running the connectors will simply wait attempt to reconnect to the Kafka brokers. The connector tasks will simply pause until a connection can be reestablished, at which point the connectors will resume exactly where they left off.</p> </div> </div> <div class="sect3"> <h4 id="_connector_is_stopped_for_a_duration">Connector is stopped for a duration</h4> <div class="paragraph"> <p>If the connector is gracefully stopped, the database can continue to be used and any new changes will be recorded in the MySQL server&#8217;s binlog. When the connector is restarted, it will resume reading the MySQL binlog where it last left off, recording change events for all of the changes that were made while the connector was stopped.</p> </div> <div class="paragraph"> <p>A properly configured Kafka cluster is able to <a href="https://engineering.linkedin.com/kafka/benchmarking-apache-kafka-2-million-writes-second-three-cheap-machines">massive throughput</a>. Kafka Connect is written with Kafka best practices, and given enough resources will also be able to handle very large numbers of database change events. Because of this, when a connector has been restarted after a while, it is very likely to catch up with the database, though how quickly will depend upon the capabilities and performance of Kafka and the volume of changes being made to the data in MySQL.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>If the connector remains stopped for long enough, MySQL might purge older binlog files and the connector&#8217;s last position may be lost. In this case, when the connector configured with <em>initial</em> snapshot mode (the default) is finally restarted, the MySQL server will no longer have the starting point and the connector will fail with an error.</p> </div> </td> </tr> </table> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="deploying-a-connector">Deploying a connector</h2> <div class="sectionbody"> <div class="paragraph"> <p>If you&#8217;ve already installed <a href="https://zookeeper.apache.org">Zookeeper</a>, <a href="http://kafka.apache.org/">Kafka</a>, and <a href="http://kafka.apache.org/documentation.html#connect">Kafka Connect</a>, then using Debezium&#8217;s MySQL connector is easy. Simply download the <a href="https://repo1.maven.org/maven2/io/debezium/debezium-connector-mysql/0.2.1/debezium-connector-mysql-0.2.1-plugin.tar.gz">connector&#8217;s plugin archive</a>, extract the JARs into your Kafka Connect environment, and add the directory with the JARs to <a href="http://docs.confluent.io/3.0.0/connect/userguide.html#installing-connector-plugins">Kafka Connect&#8217;s classpath</a>. Restart your Kafka Connect process to pick up the new JARs.</p> </div> <div class="paragraph"> <p>If immutable containers are your thing, then check out <a href="https://hub.docker.com/r/debezium/">Debezium&#8217;s Docker images</a> for Zookeeper, Kafka, and Kafka Connect with the MySQL connector already pre-installed and ready to go. Our <a href="http://debezium.io/docs/tutorial">tutorial</a> even walks you through using these images, and this is a great way to learn what Debezium is all about. You can even <a href="/blog/2016/05/31/Debezium-on-Kubernetes">run Debezium on Kubernetes and OpenShift</a>.</p> </div> <div class="paragraph"> <p>To use the connector to produce change events for a particular MySQL server or cluster, simply create a <a href="#configuration">configuration file for the MySQL Connector</a> and use the <a href="http://docs.confluent.io/3.0.0/connect/userguide.html#rest-interface">Kafka Connect REST API</a> to add that connector to your Kafka Connect cluster. When the connector starts, it will grab a consistent snapshot of the databases in your MySQL server and start reading the MySQL binlog, producing events for every inserted, updated, and deleted row. The connector can optionally produce events with the DDL statements that were applied, and you can even choose to produce events for a subset of the databases and tables. Optionally ignore, mask, or truncate columns that are sensitive, too large, or not needed.</p> </div> <div class="sect2"> <h3 id="example-configuration">Example configuration</h3> <div class="paragraph"> <p>Using the MySQL connector is straightforward. Here is an example of the configuration for a MySQL connector that monitors a MySQL server at port 3306 on 192.168.99.100, which we logically name <code>fullfillment</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-json" data-lang="json">{&#x000A;  "name": "inventory-connector",  <i class="conum" data-value="1"></i><b>(1)</b>&#x000A;  "config": {&#x000A;    "connector.class": "io.debezium.connector.mysql.MySqlConnector", <i class="conum" data-value="2"></i><b>(2)</b>&#x000A;    "database.hostname": "192.168.99.100", <i class="conum" data-value="3"></i><b>(3)</b>&#x000A;    "database.port": "3306", <i class="conum" data-value="4"></i><b>(4)</b>&#x000A;    "database.user": "debezium", <i class="conum" data-value="5"></i><b>(5)</b>&#x000A;    "database.password": "dbz", <i class="conum" data-value="6"></i><b>(6)</b>&#x000A;    "database.server.id": "184054", <i class="conum" data-value="7"></i><b>(7)</b>&#x000A;    "database.server.name": "fullfillment", <i class="conum" data-value="8"></i><b>(8)</b>&#x000A;    "database.whitelist": "inventory", <i class="conum" data-value="9"></i><b>(9)</b>&#x000A;    "database.history.kafka.bootstrap.servers": "kafka:9092", <i class="conum" data-value="10"></i><b>(10)</b>&#x000A;    "database.history.kafka.topic": "schema-changes.inventory" <i class="conum" data-value="11"></i><b>(11)</b>&#x000A;  }&#x000A;}</code></pre> </div> </div> <div class="colist arabic"> <table> <tr> <td><i class="conum" data-value="1"></i><b>1</b></td> <td>The name of our connector when we register it with a Kafka Connect service.</td> </tr> <tr> <td><i class="conum" data-value="2"></i><b>2</b></td> <td>The name of this MySQL connector class.</td> </tr> <tr> <td><i class="conum" data-value="3"></i><b>3</b></td> <td>The address of the MySQL server.</td> </tr> <tr> <td><i class="conum" data-value="4"></i><b>4</b></td> <td>The port number of the MySQL server.</td> </tr> <tr> <td><i class="conum" data-value="5"></i><b>5</b></td> <td>The name of the MySQL user that has the <a href="#mysql-user">required privileges</a>.</td> </tr> <tr> <td><i class="conum" data-value="6"></i><b>6</b></td> <td>The password for the MySQL user that has the <a href="#mysql-user">required privileges</a>.</td> </tr> <tr> <td><i class="conum" data-value="7"></i><b>7</b></td> <td>The connector&#8217;s identifier that must be unique within the MySQL cluster and similar to MySQL&#8217;s <code>server-id</code> configuration property.</td> </tr> <tr> <td><i class="conum" data-value="8"></i><b>8</b></td> <td>The logical name of the MySQL server/cluster, which forms a namespace and is used in all the names of the Kafka topics to which the connector writes, the Kafka Connect schema names, and the namespaces of the corresponding Avro schema when the <a href="#avro-converter">Avro Connector</a> is used.</td> </tr> <tr> <td><i class="conum" data-value="9"></i><b>9</b></td> <td>A list of all databases hosted by this server that this connector will monitor. This is optional, and there are other properties for listing the databases and tables to include or exclude from monitoring.</td> </tr> <tr> <td><i class="conum" data-value="10"></i><b>10</b></td> <td>The list of Kafka brokers that this connector will use to write and recover DDL statements to the database history topic.</td> </tr> <tr> <td><i class="conum" data-value="11"></i><b>11</b></td> <td>The name of the database history topic where the connector will write and recover DDL statements.</td> </tr> </table> </div> <div class="paragraph"> <p>See the <a href="#connector-properties">complete list of connector properties</a> that can be specified in these configurations.</p> </div> <div class="paragraph"> <p>This configuration can be sent via POST to a running Kafka Connect service, which will then record the configuration and start up the one connector task that will connect to the MySQL database, read the binlog, and record events to Kafka topics.</p> </div> </div> <div class="sect2"> <h3 id="connector-properties">Connector properties</h3> <div class="paragraph"> <p>The following configuration properties are <em>required</em> unless a default value is available.</p> </div> <table class="tableblock frame-all grid-all spread table table-bordered table-striped"> <colgroup> <col style="width: 35%;"> <col style="width: 10%;"> <col style="width: 55%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Property</th> <th class="tableblock halign-left valign-top">Default</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tfoot> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>connect.timeout.ms</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>30000</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>A positive integer value that specifies the maximum time in milliseconds this connector should wait after trying to connect to the MySQL database server before timing out. Defaults to 30 seconds.</p> </div></div></td> </tr> </tfoot> <tbody> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>name</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>Unique name for the connector. Attempting to register again with the same name will fail. (This property is required by all Kafka Connect connectors.)</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>connector.class</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>The name of the Java class for the connector. Always use a value of <code>io.debezium.connector.mysql.MySqlConnector</code> for the MySQL connector.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>tasks.max</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>1</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>The maximum number of tasks that should be created for this connector. The MySQL connector always uses a single task and therefore does not use this value, so the default is always acceptable.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>database.hostname</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>IP address or hostname of the MySQL database server.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>database.port</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>3306</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>Integer port number of the MySQL database server.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>database.user</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>Name of the MySQL database to use when when connecting to the MySQL database server.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>database.password</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>Password to use when when connecting to the MySQL database server.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>database.server.name</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><em>host:port</em></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>Logical name that identifies and provides a namespace for the particular MySQL database server/cluster being monitored. The logical name should be unique across all other connectors, since it is used as a prefix for all Kafka topic names eminating from this connector. Defaults to '<em>host</em>:_port_', where <em>host</em> is the value of the <code>database.hostname</code> property and <em>port</em> is the value of the <code>database.port</code> property, though we recommend using an explicit and meaningful logical name.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>database.server.id</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><em>random</em></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>A numeric ID of this database client, which must be unique across all currently-running database processes in the MySQL cluster. This connector joins the MySQL database cluster as another server (with this unique ID) so it can read the binlog. By default, a random number is generated between 5400 and 6400, though we recommend setting an explicit value.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>database.history.kafka.topic</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>The full name of the Kafka topic where the connector will store the database schema history.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>database.history.kafka.bootstrap.servers</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>A list of host/port pairs that the connector will use for establishing an initial connection to the Kafka cluster. This connection will be used to retrieving database schema history previously stored by the connector, and for writing each DDL statement read from the source database. This should point to the same Kafka cluster used by the Kafka Connect process.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>database.whitelist</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><em>empty string</em></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>An optional comma-separated list of regular expressions that match database names to be monitored; any database name not included in the whitelist will be excluded from monitoring. By default all databases will be monitoried. May not be used with <code>database.blacklist</code>.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>database.blacklist</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><em>empty string</em></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>An optional comma-separated list of regular expressions that match database names to be excluded from monitoring; any database name not included in the blacklist will be monitored. May not be used with <code>database.whitelist</code>.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>table.whitelist</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><em>empty string</em></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>An optional comma-separated list of regular expressions that match fully-qualified table identifiers for tables to be monitored; any table not included in the whitelist will be excluded from monitoring. Each identifer is of the form <em>databaseName</em>.<em>tableName</em>. By default the connector will monitor every non-system table in each monitored database. May not be used with <code>table.blacklist</code>.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>table.blacklist</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><em>empty string</em></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>An optional comma-separated list of regular expressions that match fully-qualified table identifiers for tables to be excluded from monitoring; any table not included in the blacklist will be monitored. Each identifer is of the form <em>databaseName</em>.<em>tableName</em>. May not be used with <code>table.whitelist</code>.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>column.blacklist</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><em>empty string</em></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>An optional comma-separated list of regular expressions that match the fully-qualified names of columns that should be excluded from change event message values. Fully-qualified names for columns are of the form <em>databaseName</em>.<em>tableName</em>.<em>columnName</em>, or <em>databaseName</em>.<em>schemaName</em>.<em>tableName</em>.<em>columnName</em>.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>column.truncate.to.<em>length</em>.chars</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><em>n/a</em></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>An optional comma-separated list of regular expressions that match the fully-qualified names of character-based columns whose values should be truncated in the change event message values if the field values are longer than the specified number of characters. Multiple properties with different lengths can be used in a single configuration, although in each the length must be a positive integer. Fully-qualified names for columns are of the form <em>databaseName</em>.<em>tableName</em>.<em>columnName</em>, or <em>databaseName</em>.<em>schemaName</em>.<em>tableName</em>.<em>columnName</em>.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>column.mask.with.<em>length</em>.chars</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><em>n/a</em></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>An optional comma-separated list of regular expressions that match the fully-qualified names of character-based columns whose values should be replaced in the change event message values with a field value consisting of the specified number of asterisk (<code>*</code>) characters. Multiple properties with different lengths can be used in a single configuration, although in each the length must be a positive integer. Fully-qualified names for columns are of the form <em>databaseName</em>.<em>tableName</em>.<em>columnName</em>, or <em>databaseName</em>.<em>schemaName</em>.<em>tableName</em>.<em>columnName</em>.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>include.schema.changes</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>false</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>Boolean value that specifies whether the connector should publish changes in the database schema to a Kafka topic with the same name as the database server ID. Each schema change will be recorded using a key that contains the database name and whose value includes the DDL statement(s). This is independent of how the connector internally records database history. The default is <code>false</code>.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>max.batch.size</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>2048</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>Positive integer value that specifies the maximum size of the blocking queue into which change events read from the database log are placed before they are written to Kafka. This queue can provide backpressure to the binlog reader when, for example, writes to Kafka are slower or if Kafka is not available. Events that appear in the queue are not included in the offsets periodically recorded by this connector. Defaults to 2048, and should always be larger than the maximum queue size specified in the <code>max.queue.size</code> property.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>max.queue.size</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>1024</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>Positive integer value that specifies the maximum size of each batch of events that should be processed during each iteration of this connector. Defaults to 1024.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>poll.interval.ms</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>1000</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>Positive integer value that specifies the number of milliseconds the connector should wait during each iteration for new change events to appear. Defaults to 1000 milliseconds, or 1 second.</p> </div></div></td> </tr> </tbody> </table> <div class="paragraph"> <p>The following <em>advanced</em> configuration properties have good defaults that will work in most situations and therefore rarely need to be specified in the connector&#8217;s configuration.</p> </div> <table class="tableblock frame-all grid-all spread table table-bordered table-striped"> <colgroup> <col style="width: 35%;"> <col style="width: 10%;"> <col style="width: 55%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Property</th> <th class="tableblock halign-left valign-top">Default</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tfoot> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>snapshot.minimal.locks</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>true</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>Controls how long the connector holds onto the global MySQL read lock (preventing any updates to the database) while it is performing a snapshot. The default is <code>true</code>, meaning the connector holds the global read lock for just the initial portion of the snapshot while the connector reads the database schemas and other metadata. The remaining work in a snapshot involves selecting all rows from each table, and this can be done in a consistent fashion using the <code>REPEATABLE READ</code> transaction even when the global read lock is no longer held and while other MySQL clients are updating the database. However, in some cases where clients are submitting operations that MySQL excludes from <code>REPEATABLE READ</code> semantics, it may be desirable to <em>block all writes</em> for the entire duration of the snapshot. In only such cases, set this property to <code>false</code>.</p> </div></div></td> </tr> </tfoot> <tbody> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>connect.keep.alive</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>true</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>A boolean value that specifies whether a separate thread should be used to ensure the connection to the MySQL server/cluster is kept alive.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>table.ignore.builtin</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>true</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>Boolean value that specifies whether built-in system tables should be ignored. This applies regardless of the table whitelist or blacklists. By default system tables are excluded from monitoring, and no events are generated when changes are made to any of the system tables.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>database.history.kafka.recovery.poll.interval.ms</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>100</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>An integer value that specifies the maximum number of milliseconds the connector should wait during startup/recovery while polling for persisted data. The default is 100ms.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>database.history.kafka.recovery.attempts</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>4</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>The maximum number of times that the connector should attempt to read persisted history data before the connector recovery fails with an error. The maximum amount of time to wait after receiving no data is <code>recovery.attempts</code> x <code>recovery.poll.interval.ms</code>.</p> </div></div></td> </tr> <tr> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>snapshot.mode</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p><code>initial</code></p> </div></div></td> <td class="tableblock halign-left valign-top"><div><div class="paragraph"> <p>Specifies the criteria for running a snapshot upon startup of the connector. The default is <code>initial</code>, and specifies the connector can run a snapshot only when no offsets have been recorded for the logical server name. The <code>when_needed</code> option specifies that the connector run a snapshot upon startup whenever it deems it necessary (when no offsets are available, or when a previously recorded offset specifies a binlog location or GTID that is not available in the server). The <code>never</code> option specifies that the connect should never use snapshots and that upon first startup with a logical server name the connector should read from the beginning of the binlog; this should be used with care, as it is only valid when the binlog is guaranteed to contain the entire history of the database.</p> </div></div></td> </tr> </tbody> </table> </div> </div> </div> </div> </div> </div> <footer class="container"> <div class="row"> <div class="col-md-5 col-md-offset-1"> <h4>Debezium</h4> <p> &#169; 2016 Debezium Community <br> <br> <i class="icon-fire"></i> Mixed with <a href="http://twitter.github.com/bootstrap">Bootstrap</a>, baked by <a href="http://awestruct.org">Awestruct</a>. <br> <i class="icon-flag"></i> Website and docs licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>. <br> <i class="icon-flag-alt"></i> Code released under <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, v2.0</a>. <br> <i class="icon-file-alt"></i> <a href="http://www.redhat.com/legal/legal_statement.html" title="Terms">Terms</a> | <a href="http://www.redhat.com/legal/privacy_statement.html" title="Privacy Policy">Privacy</a> </p> </div> <div class="col-md-3"> <h4>Documentation</h4> <ul class="list-unstyled"> <li> <a href="/docs/features" title="Features">Features</a> </li> <li> <a href="/docs/install" title="Install">Install</a> </li> <li> <a href="/docs/manage" title="Manage">Manage</a> </li> <li> <a href="/docs/architecture" title="Architecture">Architecture</a> </li> <li> <a href="/docs/faq" title="FAQ">FAQ</a> </li> <li> <a href="/docs/contribute" title="Contribute">Contribute</a> </li> </ul> </div> <div class="col-md-3"> <h4>Connect</h4> <ul class="list-unstyled"> <li> <a href="/blog" title="Blog">Blog</a> </li> <li> <a href="http://twitter.com/debezium" title="Twitter">Twitter</a> </li> <li> <a href="http://github.com/debezium" title="GitHub">GitHub</a> </li> <li> <a href="https://gitter.im/debezium/dev" title="Chat">Chat</a> </li> <li> <a href="https://groups.google.com/forum/#!forum/debezium" title="Google Groups">Google Groups</a> </li> <li> <a href="http://stackoverflow.com/questions/tagged/debezium" title="StackOverflow">StackOverflow</a> </li> </ul> </div> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="http://static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="http://static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.1/bootstrap-community.min.js"></script> <script type='text/javascript' language='JavaScript' src='http://www.redhat.com/j/elqNow/elqCfg.js'></script> <script type='text/javascript' language='JavaScript' src='http://www.redhat.com/j/elqNow/elqImg.js'></script> <div id="oTags"> <script type="text/javascript" src="//www.redhat.com/j/s_code.js"></script> <script type="text/javascript"><!--
        var coreUrl = encodeURI(document.URL.split("?")[0]).replace(/-/g," ");
        var urlSplit = coreUrl.toLowerCase().split(/\//);
        var urlLast = urlSplit[urlSplit.length-1];
        var pageNameString = "";
        var siteName = "";
        var minorSectionIndex = 3
        if (urlLast == "") {
            urlSplit.splice(-1,1);
        }
        if (urlLast.search(/\./) >= 0) {
            if (urlLast == "index.html") {
                urlSplit.splice(-1,1);
            }
            else {
                urlSplit[urlSplit.length-1] = urlLast.split(".").splice(0,1);
            }
        }
        siteName = urlSplit[2].split(".")[1];
        s.prop14 = s.eVar27 = siteName || "";
        s.prop15 = s.eVar28 = urlSplit[minorSectionIndex] || "";
        s.prop16 = s.eVar29 = urlSplit[minorSectionIndex+1] || "";
        pageNameString = urlSplit.splice(3).join(" | ");
        s.pageName = "jboss | community | " + siteName + " | " + pageNameString;
        s.server = "jboss";
        s.channel = "jboss | community";
        s.prop4 = s.eVar23 = encodeURI(document.URL);
        s.prop21 = s.eVar18 = coreUrl;
        s.prop2 = s.eVar22 = "en";
        s.prop3 = s.eVar19 = "us";
        //--></script> <script type="text/javascript" src="//www.redhat.com/j/rh_omni_footer.js"></script> <script language="JavaScript" type="text/javascript"><!--
        if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
        //--></script> <noscript><a href="http://www.omniture.com" title="Web Analytics"><img src="https://smtrcs.redhat.com/b/ss/redhatcom,redhatglobal/1/H.25.4--NS/0?[AQB]&cdp=3&[AQE]" height="1" width="1" border="0" alt=""/></a></noscript> </div> <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      </script> <script type="text/javascript">
      try {
      var pageTracker = _gat._getTracker("UA-10656779-1");
      pageTracker._trackPageview();
      } catch(err) {}</script> <script>
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      
                          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      
                          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      
                          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       
      ga('create', 'UA-76464546-1', 'auto');
      ga('send', 'pageview');
      ga('set', 'anonymizeIp', true);
      ga('require', 'linkid', 'linkid.js');
      
      </script> </div> </body> </html>