<!DOCTYPE html> <html lang="en"> <head> <title>Debezium Tutorial Â· Debezium</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="" name="description"> <meta content="" name="author"> <link href="http://static.jboss.org/theme/css/bootstrap-community/3.2.0.1/bootstrap-community.min.css" media="screen" rel="stylesheet"> <!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--> <link href="http://static.jboss.org/example/images/favicon.ico" rel="shortcut icon"> <link href="http://static.jboss.org/example/images/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="http://static.jboss.org/example/images/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="http://static.jboss.org/example/images/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="http://static.jboss.org/example/images/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <link href="/stylesheets/debezium.css" rel="stylesheet" type="text/css"> <style>
      @media (min-width: 980px) {
        .banner { background-image: url(http://static.jboss.org/example/images/example-banner-1180px.png); height: 110px;  }
      }
      @media (max-width: 979px) {
        .banner { background-image: url(http://static.jboss.org/example/images/example-logo.png); background-repeat:no-repeat; background-position: center bottom; height: 60px; }
      }
      @media (max-width: 650px) {
        .banner { width: 100%; margin: 0px auto; }
      }
      @media (max-width: 450px) {
        .banner { height: 90px; }
      }
    </style> <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css" rel="stylesheet"> <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script> <script>
      hljs.initHighlightingOnLoad();
    </script> <script src="http://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> <style>
      /* adjusting the vertical spacing for when a stickynav is engaged */
      .breadcrumb-fixed > .active {
        color: #8c8f91;
      }
      .breadcrumb-fixed {
        margin: 70px 0 10px;
        padding: 8px 15px;
        margin-bottom: 20px;
        list-style: none;
        background-color: #f5f5f5;
        border-radius: 4px;
      }
      
      .breadcrumb-fixed > li {
        display: inline-block;
      }
    </style> </head> <body> <div id="rhbar"> <a class="jbdevlogo" href="http://www.jboss.org/projects/about"></a> <a class="rhlogo" href="http://www.redhat.com/"></a> </div> <div id=""> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div class="container" id="content"> <div class="navbar navbar-inverse navbar-fix"> <div class="container-fluid"> <div class="navbar-header"> <button class="navbar-toggle collapsed" data-target="#navbar-1" data-toggle="collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/"> Debezium </a> </div> <div class="collapse navbar-collapse" id="navbar-1"> <ul class="nav navbar-nav pull-right"> <li class=""><a href="/docs/faq">FAQ</a></li> <li class="active"><a href="/docs">Docs</a></li> <li class=""><a href="/community">Community</a></li> <li class=""><a href="/blog">Blog</a></li> </ul> </div> </div> </div> <div id="equalHeightsLayout"> <div class="col-sm-3" id="leftdocnav"> <div class="panel-group" id="accordion1"> <div class="panel panel-docnav"> <div class="panel-heading"> <h4 class="panel-title"> <a class="accordion-toggle" data-parent="#accordion1,#accordion2,#accordion3,#accordion4" data-toggle="collapse" href="#collapse1"> Get Started </a> </h4> </div> <div class="collapse in panel-collapse" id="collapse1"><div class="panel-body"> <ul class="list-group"> <li class="list-group-item"><a href="/docs/concepts">Concepts</a></li> <li class="active list-group-item"><a href="/docs/tutorial">Tutorial</a></li> <li class="list-group-item"><a href="/docs/install">Installing Debezium</a></li> <li class="list-group-item"><a href="/docs/embedded">Embedding Debezium</a></li> </ul> </div></div> </div> </div> <div class="panel-group" id="accordion2"> <div class="panel panel-docnav"> <div class="panel-heading"> <h4 class="panel-title"> <a class="accordion-toggle" data-parent="#accordion1,#accordion2,#accordion3,#accordion4" data-toggle="collapse" href="#collapse2"> Connectors </a> </h4> </div> <div class="collapse panel-collapse" id="collapse2"><div class="panel-body"> <ul class="list-group"> <li class="list-group-item"><a href="/docs/connectors/mysql">MySQL</a></li> <li class="list-group-item"><a href="/docs/connectors/mongodb">MongoDB</a></li> <li class="list-group-item"><a href="/docs/connectors/postgresql">PostgreSQL</a></li> <li class="list-group-item"><a href="/docs/connectors/oracle">Oracle</a></li> </ul> </div></div> </div> </div> <div class="panel-group" id="accordion3"> <div class="panel panel-docnav"> <div class="panel-heading"> <h4 class="panel-title"> <a class="accordion-toggle" data-parent="#accordion1,#accordion2,#accordion3,#accordion4" data-toggle="collapse" href="#collapse3"> How it works </a> </h4> </div> <div class="collapse panel-collapse" id="collapse3"><div class="panel-body"> <ul class="list-group"> <li class="list-group-item"><a href="/docs/faq">Frequently Asked Questions</a></li> <li class="list-group-item"><a href="/docs/architecture">Debezium Architecture</a></li> <li class="list-group-item"><a href="/docs/features">Debezium Features</a></li> </ul> </div></div> </div> </div> <div class="panel-group" id="accordion4"> <div class="panel panel-docnav"> <div class="panel-heading"> <h4 class="panel-title"> <a class="accordion-toggle" data-parent="#accordion1,#accordion2,#accordion3,#accordion4" data-toggle="collapse" href="#collapse4"> Contribute </a> </h4> </div> <div class="collapse panel-collapse" id="collapse4"><div class="panel-body"> <ul class="list-group"> <li class="list-group-item"><a href="/docs/contribute">Contribute to Debezium</a></li> <li class="list-group-item"><a href="/docs/code-of-conduct">Code of Conduct</a></li> <li class="list-group-item"> <a href="https://twitter.com/debezium">Twitter</a> </li> <li class="list-group-item"> <a href="https://gitter.im/debezium/dev">Chat</a> </li> <li class="list-group-item"> <a href="https://github.com/debezium/">Code</a> </li> <li class="list-group-item"> <a href="https://issues.jboss.org/projects/DBZ/issues">Issues</a> </li> </ul> </div></div> </div> </div> </div> <div class="col-sm-9" id="maincol"> <h1 class="title"> Debezium Tutorial </h1> <div class="sect1"> <h2 id="_introduction">Introduction</h2> <div class="sectionbody"> <div class="paragraph"> <p>This tutorial walks you through running the Debezium platform for change data capture (CDC). You will use Docker (1.9 or later) to start the Debezium platform, run a MySQL database server with a simple example database, use Debezium to monitor the database, and see the resulting event streams respond as the data in the database changes.</p> </div> </div> </div> <div class="sect1"> <h2 id="_what_is_debezium">What is Debezium?</h2> <div class="sectionbody"> <div class="paragraph"> <p>Debezium is a distributed platform that turns your existing databases into event streams, so applications can see and respond immediately to each row-level change in the databases. Debezium is built on top of <a href="http://kafka.apache.org">Apache Kafka</a> and provides <a href="http://kafka.apache.org/documentation.html#connect">Kafka Connect</a> compatible connectors that monitor specific database management systems. Debezium records the history of data changes in Kafka logs, from where your application consumes them. This makes it possible for your application to easily consume all of the events correctly and completely. Even if your application stops (or crashes), upon restart it will start consume the events where it left off so it misses nothing.</p> </div> <div class="paragraph"> <p>Debezium 0.1 includes support for monitoring MySQL database servers with its <a href="/docs/connectors/mysql">MySQL connector</a>. Support for other DBMSes will be added in future releases.</p> </div> </div> </div> <div class="sect1"> <h2 id="_running_debezium_with_docker">Running Debezium with Docker</h2> <div class="sectionbody"> <div class="paragraph"> <p>Running Debezium involves three major services: <a href="http://zookeeper.apache.org">Zookeeper</a>, Kafka, and Debezium&#8217;s connector service. An easy way to try out Debezium is to use <a href="http://docker.com">Docker</a> and <a href="https://hub.docker.com/u/debezium/">Debezium&#8217;s Docker images</a>, and this tutorial walks you through doing that. Debezium can be <a href="/docs/embedded">embedded in apps</a> for smaller loads. Production environments, on the other hand, require running multiple instances of each service to provide the performance, reliability, replication, and fault tolerance. This can be done with a platform like <a href="https://www.openshift.com">OpenShift</a> and <a href="http://kubernetes.io">Kubernetes</a> that manages multiple Docker containers running on multiple hosts and machines, but often you&#8217;ll want to <a href="/docs/install">install on dedicated hardware</a>.</p> </div> </div> </div> <div class="sect1"> <h2 id="_starting_docker">Starting Docker</h2> <div class="sectionbody"> <div class="paragraph"> <p>Make sure that Docker is <a href="https://docs.docker.com/engine/installation/">installed and running</a>. If you&#8217;re running Linux, you can either run the Docker daemon or configure it to run automatically on startup. In this case, the <em>Docker host</em> is your local machine.</p> </div> <div class="paragraph"> <p>If you&#8217;re using Windows or OS X, you have to run the Docker daeomon in a virtual machine. See our <a href="/docs/docker">Docker documentation</a> for detailed instructions on installing, starting, and using Docker Machine. Every time you start a new terminal, you need to configure the Docker Machine environment so any Docker commands you run on your host computer can communicate with the Docker daemon running in the virtual machine:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ eval $(docker-machine env)</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_starting_simple_with_debezium">Starting simple with Debezium</h2> <div class="sectionbody"> <div class="paragraph"> <p>For simple evaluation and experimentation, this tutorial will walk you through starting a single instance of each service in a separate container on your local machine. Zookeeper and Kafka both store data locally inside the container, and normal usage requires mounting directories on the host machines as volumes so that when the containers stop the persisted data will remain. We&#8217;ll show how to do this later, but right now we&#8217;ll start out by not mounting any volumes. This means that when a container is removed, all persisted data will be lost. That&#8217;s actually ideal for our experiment, since nothing will be left on your computer when we&#8217;re finished, and you can run this experiment many times without having to clean anything up in between.</p> </div> <div class="paragraph"> <p>Running multiple services locally can be confusing, so we&#8217;re going to use a separate terminal to run each container in the foreground. This way all of the output of a container will be displayed in the terminal used to run it.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>This is not the only way to run Docker containers. Rather than running a container in the foreground (with <code>--it</code>), Docker lets you run a container in <em>detached</em> mode (with <code>-d</code>), where the container is started and the Docker command returns immediately. Detached mode containers don&#8217;t display their output in the terminal, though you can always see the output by using <code>docker logs --follow --name &lt;container-name&gt;</code>. This is one reason we name each of the containers we run. See the Docker documentation for more detail.</p> </div> </td> </tr> </table> </div> <div class="sect2"> <h3 id="start-zookeeper">Start Zookeeper</h3> <div class="paragraph"> <p>Of all the different services/processes that make up Debezium, the first one to start is Zookeeper. Start a new terminal with the <a href="/docs/docker">Docker environment</a>, and then start a container with Zookeeper by running:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --name zookeeper -p 2181:2181 -p 2888:2888 -p 3888:3888 debezium/zookeeper:0.1</code></pre> </div> </div> <div class="paragraph"> <p>This runs a new container using version 0.1 of the <code>debezium/zookeeper</code> image, and assigns the name <code>zookeeper</code> to this container. The <code>-it</code> flag makes the container interactive, meaning it attaches the terminal&#8217;s standard input and output to the container so that you can see what is going on in the container. The three <code>-p</code> options map three of the container&#8217;s ports (e.g., 2181, 2888, and 3888) to the same ports on the Docker host so that other containers (and software outside the container) can talk with Zookeeper.</p> </div> <div class="paragraph"> <p>You should see in your terminal the typical output of Zookeeper:</p> </div> <div class="listingblock"> <div class="content"> <pre class="nowrap">Starting up in standalone mode&#x000A;JMX enabled by default&#x000A;Using config: /zookeeper/conf/zoo.cfg&#x000A;2016-03-09 18:42:16,428 - INFO  [main:QuorumPeerConfig@103] - Reading configuration from: /zookeeper/conf/zoo.cfg&#x000A;2016-03-09 18:42:16,435 - INFO  [main:DatadirCleanupManager@78] - autopurge.snapRetainCount set to 3&#x000A;2016-03-09 18:42:16,436 - INFO  [main:DatadirCleanupManager@79] - autopurge.purgeInterval set to 1&#x000A;2016-03-09 18:42:16,437 - WARN  [main:QuorumPeerMain@113] - Either no config or no quorum defined in config, running  in standalone mode&#x000A;2016-03-09 18:42:16,440 - INFO  [PurgeTask:DatadirCleanupManager$PurgeTask@138] - Purge task started.&#x000A;2016-03-09 18:42:16,457 - INFO  [main:QuorumPeerConfig@103] - Reading configuration from: /zookeeper/conf/zoo.cfg&#x000A;2016-03-09 18:42:16,461 - INFO  [main:ZooKeeperServerMain@95] - Starting server&#x000A;2016-03-09 18:42:16,465 - INFO  [PurgeTask:DatadirCleanupManager$PurgeTask@144] - Purge task completed.&#x000A;2016-03-09 18:42:16,478 - INFO  [main:Environment@100] - Server environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT&#x000A;2016-03-09 18:42:16,479 - INFO  [main:Environment@100] - Server environment:host.name=a780c032179e&#x000A;2016-03-09 18:42:16,479 - INFO  [main:Environment@100] - Server environment:java.version=1.8.0_72-internal&#x000A;2016-03-09 18:42:16,479 - INFO  [main:Environment@100] - Server environment:java.vendor=Oracle Corporation&#x000A;2016-03-09 18:42:16,479 - INFO  [main:Environment@100] - Server environment:java.home=/usr/lib/jvm/java-8-openjdk-amd64/jre&#x000A;2016-03-09 18:42:16,479 - INFO  [main:Environment@100] - Server environment:java.class.path=/zookeeper/bin/../build/classes:/zookeeper/bin/../build/lib/*.jar:/zookeeper/bin/../lib/slf4j-log4j12-1.6.1.jar:/zookeeper/bin/../lib/slf4j-api-1.6.1.jar:/zookeeper/bin/../lib/netty-3.7.0.Final.jar:/zookeeper/bin/../lib/log4j-1.2.16.jar:/zookeeper/bin/../lib/jline-0.9.94.jar:/zookeeper/bin/../zookeeper-3.4.6.jar:/zookeeper/bin/../src/java/lib/*.jar:/zookeeper/conf:&#x000A;2016-03-09 18:42:16,479 - INFO  [main:Environment@100] - Server environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib&#x000A;2016-03-09 18:42:16,480 - INFO  [main:Environment@100] - Server environment:java.io.tmpdir=/tmp&#x000A;2016-03-09 18:42:16,483 - INFO  [main:Environment@100] - Server environment:java.compiler=&lt;NA&gt;&#x000A;2016-03-09 18:42:16,484 - INFO  [main:Environment@100] - Server environment:os.name=Linux&#x000A;2016-03-09 18:42:16,484 - INFO  [main:Environment@100] - Server environment:os.arch=amd64&#x000A;2016-03-09 18:42:16,484 - INFO  [main:Environment@100] - Server environment:os.version=4.1.17-boot2docker&#x000A;2016-03-09 18:42:16,484 - INFO  [main:Environment@100] - Server environment:user.name=zookeeper&#x000A;2016-03-09 18:42:16,484 - INFO  [main:Environment@100] - Server environment:user.home=/zookeeper&#x000A;2016-03-09 18:42:16,486 - INFO  [main:Environment@100] - Server environment:user.dir=/zookeeper&#x000A;2016-03-09 18:42:16,492 - INFO  [main:ZooKeeperServer@755] - tickTime set to 2000&#x000A;2016-03-09 18:42:16,492 - INFO  [main:ZooKeeperServer@764] - minSessionTimeout set to -1&#x000A;2016-03-09 18:42:16,492 - INFO  [main:ZooKeeperServer@773] - maxSessionTimeout set to -1&#x000A;2016-03-09 18:42:16,507 - INFO  [main:NIOServerCnxnFactory@94] - binding to port 0.0.0.0/0.0.0.0:2181</pre> </div> </div> <div class="paragraph"> <p>The last line is important and reports that Zookeeper is ready and listening on port 2181. The terminal will continue to show additional output as Zookeeper generates it.</p> </div> </div> <div class="sect2"> <h3 id="start-kafka">Start Kafka</h3> <div class="paragraph"> <p>Open a new terminal and configure it with the <a href="/docs/docker">Docker environment</a>. Then, start Kafka in a new container by running:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --name kafka -p 9092:9092 -e ADVERTISED_HOST_NAME=$(docker-machine ip) --link zookeeper:zookeeper debezium/kafka:0.1</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>On Linux, simply replace the <code>$(docker-machine ip)</code> portion of the command with <code>localhost</code>, and do the same in any other commands in which it appears.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>This runs a new container using version 0.1 of the <code>debezium/kafka</code> image, and assigns the name <code>kafka</code> to this container. The <code>-it</code> flag makes the container interactive, meaning it attaches the terminal&#8217;s standard input and output to the container so that you can see what is going on in the container. The command maps port 9092 in the container to the same port on the Docker host so that software outside of the container can talk with Kafka. The command uses <code>-e</code> option to set the <code>ADVERTISED_HOST_NAME</code> environment variable in the container to the IP address of the <em>Docker host</em>, and the container uses this environment variable when configuring and starting Kafka so that Kafka properly reports to clients the IP address where it can be found. In our case, we use the <code>docker-machine ip</code> command to optain the IP address of the Docker host. Finally, the command uses the <code>--link zookeeper:zookeeper</code> argument to tell the container that it can find Zookeeper in the container named <code>zookeeper</code> running on the same Docker host.</p> </div> <div class="paragraph"> <p>You should see in your terminal the typical output of Kafka, ending with:</p> </div> <div class="listingblock"> <div class="content"> <pre class="nowrap">...&#x000A;2016-03-09 18:59:08,771 - INFO  [main-EventThread:ZkClient@711] - zookeeper state changed (SyncConnected)&#x000A;2016-03-09 18:59:08,877 - INFO  [main:Logging$class@68] - Loading logs.&#x000A;2016-03-09 18:59:08,885 - INFO  [main:Logging$class@68] - Logs loading complete.&#x000A;2016-03-09 18:59:08,920 - INFO  [main:Logging$class@68] - Starting log cleanup with a period of 300000 ms.&#x000A;2016-03-09 18:59:08,929 - INFO  [main:Logging$class@68] - Starting log flusher with a default period of 9223372036854775807 ms.&#x000A;2016-03-09 18:59:08,932 - WARN  [main:Logging$class@83] - No meta.properties file under dir /kafka/data/1/meta.properties&#x000A;2016-03-09 18:59:08,990 - INFO  [main:Logging$class@68] - Awaiting socket connections on 0.0.0.0:9092.&#x000A;2016-03-09 18:59:08,993 - INFO  [main:Logging$class@68] - [Socket Server on Broker 1], Started 1 acceptor threads&#x000A;2016-03-09 18:59:09,014 - INFO  [ExpirationReaper-1:Logging$class@68] - [ExpirationReaper-1], Starting&#x000A;2016-03-09 18:59:09,015 - INFO  [ExpirationReaper-1:Logging$class@68] - [ExpirationReaper-1], Starting&#x000A;2016-03-09 18:59:09,066 - INFO  [main:Logging$class@68] - Creating /controller (is it secure? false)&#x000A;2016-03-09 18:59:09,074 - INFO  [main:Logging$class@68] - Result of znode creation is: OK&#x000A;2016-03-09 18:59:09,075 - INFO  [main:Logging$class@68] - 1 successfully elected as leader&#x000A;2016-03-09 18:59:09,186 - INFO  [main:Logging$class@68] - [GroupCoordinator 1]: Starting up.&#x000A;2016-03-09 18:59:09,218 - INFO  [group-metadata-manager-0:Logging$class@68] - [Group Metadata Manager on Broker 1]: Removed 0 expired offsets in 21 milliseconds.&#x000A;2016-03-09 18:59:09,222 - INFO  [ExpirationReaper-1:Logging$class@68] - [ExpirationReaper-1], Starting&#x000A;2016-03-09 18:59:09,222 - INFO  [main:Logging$class@68] - [GroupCoordinator 1]: Startup complete.&#x000A;2016-03-09 18:59:09,264 - INFO  [ExpirationReaper-1:Logging$class@68] - [ExpirationReaper-1], Starting&#x000A;2016-03-09 18:59:09,275 - INFO  [ThrottledRequestReaper-Produce:Logging$class@68] - [ThrottledRequestReaper-Produce], Starting&#x000A;2016-03-09 18:59:09,278 - INFO  [ThrottledRequestReaper-Fetch:Logging$class@68] - [ThrottledRequestReaper-Fetch], Starting&#x000A;2016-03-09 18:59:09,311 - INFO  [main:Logging$class@68] - Will not load MX4J, mx4j-tools.jar is not in the classpath&#x000A;2016-03-09 18:59:09,328 - INFO  [main:Logging$class@68] - Creating /brokers/ids/1 (is it secure? false)&#x000A;2016-03-09 18:59:09,335 - INFO  [main:Logging$class@68] - Result of znode creation is: OK&#x000A;2016-03-09 18:59:09,337 - INFO  [ZkClient-EventThread-14-172.17.0.2:2181:Logging$class@68] - New leader is 1&#x000A;2016-03-09 18:59:09,338 - INFO  [main:Logging$class@68] - Registered broker 1 at path /brokers/ids/1 with addresses: PLAINTEXT -&gt; EndPoint(172.17.0.3,9092,PLAINTEXT)&#x000A;2016-03-09 18:59:09,353 - INFO  [main:AppInfoParser$AppInfo@82] - Kafka version : 0.9.0.1&#x000A;2016-03-09 18:59:09,353 - INFO  [main:AppInfoParser$AppInfo@83] - Kafka commitId : 23c69d62a0cabf06&#x000A;2016-03-09 18:59:09,354 - INFO  [main:Logging$class@68] - [Kafka Server 1], started</pre> </div> </div> <div class="paragraph"> <p>The last line shown above reports that the Kafka broker has successfully started and is ready for client connections. The terminal will continue to show additional output as Kafka generates it.</p> </div> </div> <div class="sect2"> <h3 id="start-kafka-connect">Start Kafka Connect</h3> <div class="paragraph"> <p>Open a new terminal and configure it with the <a href="/docs/docker">Docker environment</a>. In that terminal, start the Kafka Connect service in a new container by running:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --name connect -p 8083:8083 -e GROUP_ID=1 -e CONFIG_STORAGE_TOPIC=my-connect-configs -e OFFSET_STORAGE_TOPIC=my-connect-offsets -e ADVERTISED_HOST_NAME=$(docker-machine ip) --link zookeeper:zookeeper --link kafka:kafka debezium/connect:0.1</code></pre> </div> </div> <div class="paragraph"> <p>This runs a new container using version 0.1 of the <code>debezium/connect</code> image, and assigns the name <code>connect</code> to this container. The <code>-it</code> flag makes the container interactive, meaning it attaches the terminal&#8217;s standard input and output to the container so that you can see what is going on in the container. The command maps port 8083 in the container to the same port on the Docker host so that software outside of the container can use Kafka Connect&#8217;s REST API to set up and manage new connector instances. The command uses the <code>--link zookeeper:zookeeper</code> and <code>--link kafka:kafka</code> argument to tell the container that it can find Zookeeper and Kafka in the container named <code>zookeeper</code> and <code>kafka</code>, respectively, running on the same Docker host. And finally, it also uses the <code>-e</code> option four times to set the <code>GROUP_ID</code>, <code>CONFIG_STORAGE_TOPIC</code>, <code>OFFSET_STORAGE_TOPIC</code>, and <code>ADVERTISED_HOST_NAME</code> environment variables; the first three are required by this container (you can use different values as desired), while the last variable is optional but is used by the Kafka Connect server process to tell clients and other service instances the address at which it is listening. In our case, we use the <code>docker-machine ip</code> command to optain the IP address of the Docker host.</p> </div> <div class="paragraph"> <p>You should see in your terminal the typical output of Kafka, ending with:</p> </div> <div class="listingblock"> <div class="content"> <pre class="nowrap">...&#x000A;2016-03-14 18:19:45,222 - INFO  [DistributedHerder:AppInfoParser$AppInfo@82] - Kafka version : 0.9.0.1&#x000A;2016-03-14 18:19:45,222 - INFO  [DistributedHerder:AppInfoParser$AppInfo@83] - Kafka commitId : 23c69d62a0cabf06&#x000A;2016-03-14 18:19:45,463 - INFO  [main:Server@327] - jetty-9.2.12.v20150709&#x000A;2016-03-14 18:19:46,024 - INFO  [DistributedHerder:KafkaBasedLog@143] - Finished reading KafakBasedLog for topic my-connect-configs&#x000A;2016-03-14 18:19:46,024 - INFO  [DistributedHerder:KafkaBasedLog@145] - Started KafakBasedLog for topic my-connect-configs&#x000A;2016-03-14 18:19:46,024 - INFO  [DistributedHerder:KafkaConfigStorage@242] - Started KafkaConfigStorage&#x000A;2016-03-14 18:19:46,024 - INFO  [DistributedHerder:DistributedHerder@156] - Herder started&#x000A;2016-03-14 18:19:46,362 - INFO  [DistributedHerder:DistributedHerder$14@868] - Joined group and got assignment: Assignment{error=0, leader='connect-1-79c73a23-e6a6-4ef1-aedc-a9298da8e022', leaderUrl='http://192.168.99.100:8083/', offset=-1, connectorIds=[], taskIds=[]}&#x000A;2016-03-14 18:19:46,363 - INFO  [DistributedHerder:DistributedHerder@639] - Starting connectors and tasks using config offset -1&#x000A;2016-03-14 18:19:46,364 - INFO  [DistributedHerder:DistributedHerder@659] - Finished starting connectors and tasks&#x000A;...&#x000A;2016-03-14 18:19:46,497 - INFO  [main:ContextHandler@744] - Started o.e.j.s.ServletContextHandler@1f2f9244{/,null,AVAILABLE}&#x000A;2016-03-14 18:19:46,518 - INFO  [main:AbstractConnector@266] - Started ServerConnector@3d99a0aa{HTTP/1.1}{172.17.0.4:8083}&#x000A;2016-03-14 18:19:46,524 - INFO  [main:Server@379] - Started @5039ms&#x000A;2016-03-14 18:19:46,526 - INFO  [main:RestServer@132] - REST server listening at http://172.17.0.4:8083/, advertising URL http://192.168.99.100:8083/&#x000A;2016-03-14 18:19:46,526 - INFO  [main:Connect@60] - Kafka Connect started</pre> </div> </div> <div class="paragraph"> <p>The last line shown above reports that the service has started and is ready for connections. The terminal will continue to show additional output as the Kafka Connect service generates it.</p> </div> <div class="sect3"> <h4 id="kafka-connect-api">Using the Kafka Connect REST API</h4> <div class="paragraph"> <p>The Kafka Connect service exposes a RESTful API to manage the set of connectors, so let&#8217;s use that API using the <code>curl</code> command line tool. Because we mapped port 8083 in the <code>connect</code> container (where the Kafka Connect service is running) to port 8083 on the Docker host, we can communicate to the service by sending the request to port 8083 on the Docker host, which then forwards the request to the Kakfa Connect service.</p> </div> <div class="paragraph"> <p>Open a new terminal and configure it with the <a href="/docs/docker">Docker environment</a>, and in that terminal run the following command to check the status of the Kafka Connect service:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ curl -H "Accept:application/json" $(docker-machine ip):8083/</code></pre> </div> </div> <div class="paragraph"> <p>The Kafka Connect service should return a JSON response message similar to the following:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">{"version":"0.9.0.1","commit":"23c69d62a0cabf06"}</code></pre> </div> </div> <div class="paragraph"> <p>This shows that we&#8217;re running Kafka Connect version 0.9.0.1. Next, check the list of connectors:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ curl -H "Accept:application/json" $(docker-machine ip):8083/connectors/</code></pre> </div> </div> <div class="paragraph"> <p>which should return the following:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">[]</code></pre> </div> </div> <div class="paragraph"> <p>This confirms that the Kafka Connect service is running, that we can talk with it, and that it currently has no connectors.</p> </div> </div> </div> <div class="sect2"> <h3 id="start-mysql">Start a MySQL database</h3> <div class="paragraph"> <p>At this point, we&#8217;ve started Zookeeper, Kafka, and Kafka Connect, but we&#8217;ve not yet configured Kafka Connect to run any connectors. In other words, the basic Debezium services are running but they&#8217;re not yet watching any databases. Before we can set up connectors, we first need a relational database to monitor.</p> </div> <div class="paragraph"> <p>Open a new terminal and configure it with the <a href="/docs/docker">Docker environment</a>. In that terminal, start a new container that runs a MySQL database server preconfigured with an <code>inventory</code> database:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=debezium -e MYSQL_USER=mysqluser -e MYSQL_PASSWORD=mysqlpw debezium/example-mysql:0.1</code></pre> </div> </div> <div class="paragraph"> <p>This runs a new container using version 0.1 of the <code>debezium/example-mysql</code> image, which is <a href="https://github.com/debezium/docker-images/blob/master/examples/mysql/0.1/Dockerfile">based on</a> the <a href="https://hub.docker.com/r/_/mysql/">mysql:5.7</a> image and defines and populate a sample "inventory" database. The command assigns the name <code>mysql</code> to the container so that it can be easily referenced later. The <code>-it</code> flag makes the container interactive, meaning it attaches the terminal&#8217;s standard input and output to the container so that you can see what is going on in the container. The command maps port 3036 (the default MySQL port) in the container to the same port on the Docker host so that software outside of the container can connect to the database server. And finally, it also uses the <code>-e</code> option three times to set the <code>MYSQL_ROOT_PASSWORD</code>, <code>MYSQL_USER</code>, and <code>MYSQL_PASSWORD</code> environment variables to specific values.</p> </div> <div class="paragraph"> <p>You should see in your terminal something like the following:</p> </div> <div class="listingblock"> <div class="content"> <pre class="nowrap">...&#x000A;2016-03-14T22:30:15.657044Z 0 [Note] mysqld: Shutdown complete&#x000A;&#x000A;&#x000A;MySQL init process done. Ready for start up.&#x000A;&#x000A;2016-03-14T22:30:15.861721Z 0 [Note] mysqld (mysqld 5.7.11-log) starting as process 1 ...&#x000A;2016-03-14T22:30:15.866636Z 0 [Note] InnoDB: PUNCH HOLE support available&#x000A;2016-03-14T22:30:15.866710Z 0 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins&#x000A;2016-03-14T22:30:15.866727Z 0 [Note] InnoDB: Uses event mutexes&#x000A;2016-03-14T22:30:15.866741Z 0 [Note] InnoDB: GCC builtin __atomic_thread_fence() is used for memory barrier&#x000A;2016-03-14T22:30:15.866771Z 0 [Note] InnoDB: Compressed tables use zlib 1.2.8&#x000A;2016-03-14T22:30:15.866788Z 0 [Note] InnoDB: Using Linux native AIO&#x000A;2016-03-14T22:30:15.866989Z 0 [Note] InnoDB: Number of pools: 1&#x000A;2016-03-14T22:30:15.867150Z 0 [Note] InnoDB: Using CPU crc32 instructions&#x000A;2016-03-14T22:30:15.873427Z 0 [Note] InnoDB: Initializing buffer pool, total size = 128M, instances = 1, chunk size = 128M&#x000A;2016-03-14T22:30:15.879085Z 0 [Note] InnoDB: Completed initialization of buffer pool&#x000A;2016-03-14T22:30:15.880199Z 0 [Note] InnoDB: If the mysqld execution user is authorized, page cleaner thread priority can be changed. See the man page of setpriority().&#x000A;2016-03-14T22:30:15.891387Z 0 [Note] InnoDB: Highest supported file format is Barracuda.&#x000A;2016-03-14T22:30:15.897290Z 0 [Note] InnoDB: Creating shared tablespace for temporary tables&#x000A;2016-03-14T22:30:15.897383Z 0 [Note] InnoDB: Setting file './ibtmp1' size to 12 MB. Physically writing the file full; Please wait ...&#x000A;2016-03-14T22:30:15.917036Z 0 [Note] InnoDB: File './ibtmp1' size is now 12 MB.&#x000A;2016-03-14T22:30:15.917555Z 0 [Note] InnoDB: 96 redo rollback segment(s) found. 96 redo rollback segment(s) are active.&#x000A;2016-03-14T22:30:15.917580Z 0 [Note] InnoDB: 32 non-redo rollback segment(s) are active.&#x000A;2016-03-14T22:30:15.918970Z 0 [Note] InnoDB: Waiting for purge to start&#x000A;2016-03-14T22:30:15.969933Z 0 [Note] InnoDB: 5.7.11 started; log sequence number 12028636&#x000A;2016-03-14T22:30:15.970156Z 0 [Note] Plugin 'FEDERATED' is disabled.&#x000A;2016-03-14T22:30:15.970905Z 0 [Note] InnoDB: Loading buffer pool(s) from /var/lib/mysql/ib_buffer_pool&#x000A;2016-03-14T22:30:15.974684Z 0 [Note] InnoDB: Buffer pool(s) load completed at 160314 22:30:15&#x000A;2016-03-14T22:30:15.991369Z 0 [Warning] Failed to set up SSL because of the following SSL library error: SSL context is not usable without certificate and private key&#x000A;2016-03-14T22:30:15.991427Z 0 [Note] Server hostname (bind-address): '*'; port: 3306&#x000A;2016-03-14T22:30:15.991465Z 0 [Note] IPv6 is available.&#x000A;2016-03-14T22:30:15.991482Z 0 [Note]   - '::' resolves to '::';&#x000A;2016-03-14T22:30:15.991496Z 0 [Note] Server socket created on IP: '::'.&#x000A;2016-03-14T22:30:15.993289Z 0 [Warning] 'db' entry 'sys mysql.sys@localhost' ignored in --skip-name-resolve mode.&#x000A;2016-03-14T22:30:15.993351Z 0 [Warning] 'proxies_priv' entry '@ root@localhost' ignored in --skip-name-resolve mode.&#x000A;2016-03-14T22:30:15.995123Z 0 [Warning] 'tables_priv' entry 'sys_config mysql.sys@localhost' ignored in --skip-name-resolve mode.&#x000A;2016-03-14T22:30:16.000548Z 0 [Note] Event Scheduler: Loaded 0 events&#x000A;2016-03-14T22:30:16.000711Z 0 [Note] mysqld: ready for connections.</pre> </div> </div> <div class="paragraph"> <p>Notice that the MySQL server starts and stops a few times as the configuration is modified. The <code>mysqld: ready for connections</code> line reports that the MySQL server is running.</p> </div> </div> <div class="sect2"> <h3 id="start-mysql-command-line">Start a MySQL command line client</h3> <div class="paragraph"> <p>Open a new terminal and configure it with the <a href="/docs/docker">Docker environment</a>. In that terminal, run the following to start a new container to run the MySQL command line client and connect it to the MySQL server running in the <code>mysql</code> container:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --name mysqlterm --link mysql --rm mysql:5.7 sh -c 'exec mysql -h"$MYSQL_PORT_3306_TCP_ADDR" -P"$MYSQL_PORT_3306_TCP_PORT" -uroot -p"$MYSQL_ENV_MYSQL_ROOT_PASSWORD"'</code></pre> </div> </div> <div class="paragraph"> <p>Here we start the container using the <a href="https://hub.docker.com/r/_/mysql/">mysql:5.7</a> image, name the container <code>mysqlterm</code> and link it to the <code>mysql</code> container where the database server is running. The <code>--rm</code> option tells Docker to remove the container when it stops, and the rest of the command defines the shell command that the container should run. This shell command runs the MySQL command line client and specifies the correct options so that it can connect properly.</p> </div> <div class="paragraph"> <p>The container should output lines similar to the following:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">mysql: [Warning] Using a password on the command line interface can be insecure.&#x000A;Welcome to the MySQL monitor.  Commands end with ; or \g.&#x000A;Your MySQL connection id is 2&#x000A;&#x000A;Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.&#x000A;&#x000A;Oracle is a registered trademark of Oracle Corporation and/or its&#x000A;affiliates. Other names may be trademarks of their respective&#x000A;owners.&#x000A;&#x000A;Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.&#x000A;&#x000A;mysql&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Unlike the other containers, this container runs a process that produces a prompt. We&#8217;ll use the prompt to interact with the database. First, switch to the "inventory" database:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-sql" data-lang="sql">mysql&gt; use inventory;</code></pre> </div> </div> <div class="paragraph"> <p>and then list the tables in the database:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-sql" data-lang="sql">mysql&gt; show tables;</code></pre> </div> </div> <div class="paragraph"> <p>which should then display:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-sql" data-lang="sql">+---------------------+&#x000A;| Tables_in_inventory |&#x000A;+---------------------+&#x000A;| customers           |&#x000A;| orders              |&#x000A;| products            |&#x000A;| products_on_hand    |&#x000A;+---------------------+&#x000A;4 rows in set (0.00 sec)</code></pre> </div> </div> <div class="paragraph"> <p>Use the MySQL command line client to explore the database and view the pre-loaded data in the database. For example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-sql" data-lang="sql">mysql&gt; SELECT * FROM customers;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="monitor-mysql">Monitor the MySQL database</h3> <div class="paragraph"> <p>At this point we are running the Debezium services, a MySQL database server with a sample <code>inventory</code> database, and the MySQL command line client that is connected to our database. The next step is to register a connector that will begin monitoring the MySQL database server&#8217;s binlog and generate change events for each row that has been (or will be) changed. Since this is a new connector, when it starts it will start reading from the beginning of the MySQL binlog, which records all of the transactions, including individual row changes and changes to the schemas.</p> </div> <div class="paragraph"> <p>It is essential that the connector keep track of the schema changes, because each row change is recorded in the binlog in terms of the structure of its table <em>at the time the row was changed</em>. As our connector reads the binlog, the connector is actually replaying the history of the database and must keep track of the structure of each table to properly interpret the row changes. MySQL records in the binlog all DDL statements that change the database schema, so Debezium&#8217;s MySQL connector parses and uses these DDL statements to maintain an in-memory model of the structure of each table. It also records these DDL statements in a separate Kafka topic so that the connector can recover the structure of the database that existed at any point in time, as defined by the statements in the binlog.</p> </div> <div class="paragraph"> <p>So before we start the connector, we need to create that Kafka topic where the connector can write out the database&#8217;s schema history. We&#8217;ll use the <code>debezium/kafka</code> image to start a container that runs the Kafka utility to create a <code>schema-changes.inventory</code> topic.</p> </div> <div class="paragraph"> <p>Go back to your terminal where you ran the <code>curl</code> commands against the Kafka Connect service, and run the following to create the topic:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --rm --link zookeeper:zookeeper debezium/kafka:0.1 create-topic -r 1 schema-changes.inventory</code></pre> </div> </div> <div class="paragraph"> <p>The command runs a container using version 0.1 of the <code>debezium/kafka</code> image, uses <code>--rm</code> to tell Docker to remove the container when it stops, and links to the Zookeeper container so that the utility can find the Kafka broker(s). The command runs the <code>create-topic</code> utility, which by default create a topic with one partition - exactly what we want so that total order of all DDL statements is maintained. The <code>-r 1</code> argument specifies the topic should have 1 replica.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> <div class="paragraph"> <p>Normally we&#8217;d want 3 or more replicas so that we reduce the risk of losing data should brokers fail. But since we&#8217;re just running a single broker in our tutorial, we can only specify 1 replia.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>You&#8217;ll see output similar to the following:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code>Creating new topic schema-changes.inventory with 1 partition(s) and 1 replica(s)...&#x000A;Created topic "schema-changes.inventory".</code></pre> </div> </div> <div class="paragraph"> <p>The container will exit as soon as the request to create the topic completes, and because <code>--rm</code> is used the container will be immediately removed.</p> </div> <div class="paragraph"> <p>Now we&#8217;re ready to start our connector. Using the same terminal, we&#8217;ll use <code>curl</code> to submit to our Kafka Connect service a JSON request message with information about our connector:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ curl -i -X POST -H "Accept:application/json" -H "Content-Type:application/json" 192.168.99.100:8083/connectors/ -d '{ "name": "inventory-connector", "config": { "connector.class": "io.debezium.connector.mysql.MySqlConnector", "tasks.max": "1", "database.hostname": "192.168.99.100", "database.port": "3306", "database.user": "replicator", "database.password": "replpass", "database.server.id": "184054", "database.server.name": "mysql-server-1", "database.binlog": "mysql-bin.000001", "database.whitelist": "inventory", "database.history.kafka.bootstrap.servers": "kafka:9092", "database.history.kafka.topic": "schema-changes.inventory" } }'</code></pre> </div> </div> <div class="paragraph"> <p>This command uses the Kafka Connect service&#8217;s RESTful API to submit a <code>POST</code> request against <code>/connectors</code> resource with a JSON document that describes our new connector. Here&#8217;s the same JSON message in a more readable format:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">{&#x000A;    "name": "inventory-connector",&#x000A;    "config": {&#x000A;        "connector.class": "io.debezium.connector.mysql.MySqlConnector",&#x000A;        "tasks.max": "1",&#x000A;        "database.hostname": "192.168.99.100",&#x000A;        "database.port": "3306",&#x000A;        "database.user": "replicator",&#x000A;        "database.password": "replpass",&#x000A;        "database.server.id": "184054",&#x000A;        "database.server.name": "mysql-server-1",&#x000A;        "database.binlog": "mysql-bin.000001",&#x000A;        "database.whitelist": "inventory",&#x000A;        "database.history.kafka.bootstrap.servers": "kafka:9092",&#x000A;        "database.history.kafka.topic": "schema-changes.inventory",&#x000A;    }&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>The JSON message specifies the connector name as <code>inventory-connector</code>, and provides the detailed <a href="/docs/connectors/mysql#configuration">configuration properties for our MySQL connector</a>:</p> </div> <div class="ulist"> <ul> <li> <p>Exactly one task should operate at any one time. Since the MySQL connect reads the MySQL server&#8217;s binlog, and using a single connector task is the only way to ensure the proper order and that all events are handled properly.</p> </li> <li> <p>The database host and port are specified.</p> </li> <li> <p>The MySQL database we&#8217;re running has a <code>replicator</code> user set up expressly for our purposes, so we specify that username and password here.</p> </li> <li> <p>A unique server ID and name are given. The server name is the logical identifier for the MySQL server or cluster of servers, and will be used as the prefix for all Kafka topics.</p> </li> <li> <p>The name of the initial binlog file is given. We start at the first file, but you can alternatively specify others.</p> </li> <li> <p>We only want to detect changes in the <code>inventory</code> database, so we use a whitelist.</p> </li> <li> <p>The connector should store the history of the database schemas in Kafka using the named broker (the same broker to which we&#8217;re sending events) and topic name. Upon restart, the connector will recover the schemas of the database(s) that existed at the point in time in the binlog when the connector should begin reading.</p> </li> </ul> </div> <div class="paragraph"> <p>This command should produce a response similar to the following (perhaps a bit more compact):</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-http" data-lang="http">HTTP/1.1 201 Created&#x000A;Date: Wed, 16 Mar 2016 15:20:55 GMT&#x000A;Location: http://192.168.99.100:8083/connectors/inventory-connector&#x000A;Content-Type: application/json&#x000A;Content-Length: 534&#x000A;Server: Jetty(9.2.12.v20150709)&#x000A;&#x000A;{&#x000A;    "name":"inventory-connector",&#x000A;    "config":{&#x000A;        "connector.class":"io.debezium.connector.mysql.MySqlConnector",&#x000A;        "tasks.max":"1",&#x000A;        "database.hostname":"192.168.99.100",&#x000A;        "database.port":"3306",&#x000A;        "database.user":"replicator",&#x000A;        "database.password":"replpass",&#x000A;        "database.server.id":"184054",&#x000A;        "database.server.name":"mysql-server-1",&#x000A;        "database.binlog":"mysql-bin.000001",&#x000A;        "database.whitelist":"inventory",&#x000A;        "database.history.kafka.bootstrap.servers":"kafka:9092",&#x000A;        "database.history.kafka.topic":"schema-changes.inventory",&#x000A;        "name":"inventory-connector"&#x000A;    },&#x000A;    "tasks":[]&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>This specifies that our connector resource <code>/connectors/inventory-connector</code> was created and includes the connector&#8217;s configuration and information about the tasks. Since the connector was just created, the service hasn&#8217;t yet finished starting tasks.</p> </div> <div class="paragraph"> <p>We can even use the RESTful API to verify that our connector is included in the list of connectors:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ curl -H "Accept:application/json" 192.168.99.100:8083/connectors/</code></pre> </div> </div> <div class="paragraph"> <p>which should return the following:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">["inventory-connector"]</code></pre> </div> </div> <div class="paragraph"> <p>Recall that the Kafka Connect service uses connectors to start one or more tasks that do the work, and that it will automatically distribute the running tasks across the cluster of Kafka Connect services. Should any of the services stop or crash, those tasks will be redistributed to running services. We can see the tasks when we get the state of the connector:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ curl -i -X GET -H "Accept:application/json" 192.168.99.100:8083/connectors/inventory-connector</code></pre> </div> </div> <div class="paragraph"> <p>which returns:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-http" data-lang="http">HTTP/1.1 200 OK&#x000A;Date: Wed, 16 Mar 2016 15:26:12 GMT&#x000A;Content-Type: application/json&#x000A;Content-Length: 578&#x000A;Server: Jetty(9.2.12.v20150709)&#x000A;&#x000A;{&#x000A;    "name":"inventory-connector",&#x000A;    "config":{&#x000A;        "connector.class":"io.debezium.connector.mysql.MySqlConnector",&#x000A;        "tasks.max":"1",&#x000A;        "database.hostname":"192.168.99.100",&#x000A;        "database.port":"3306",&#x000A;        "database.user":"replicator",&#x000A;        "database.password":"replpass",&#x000A;        "database.server.id":"184054",&#x000A;        "database.server.name":"mysql-server-1",&#x000A;        "database.binlog":"mysql-bin.000001",&#x000A;        "database.whitelist":"inventory",&#x000A;        "database.history.kafka.bootstrap.servers":"kafka:9092",&#x000A;        "database.history.kafka.topic":"schema-changes.inventory",&#x000A;        "name":"inventory-connector"&#x000A;    },&#x000A;    "tasks":[&#x000A;        {&#x000A;            "connector":"inventory-connector",&#x000A;            "task":0&#x000A;        }&#x000A;    ]&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>Here, we can see that the connector is running a single task (e.g., task 0) to do its work. The MySQL connector only supports a single task, since we can&#8217;t really have multiple readers of a single binlog.</p> </div> <div class="paragraph"> <p>If we look at the output of our <code>connect</code> container, we should now see lines similar to the following</p> </div> <div class="listingblock"> <div class="content"> <pre class="nowrap">....&#x000A;2016-03-16 15:20:58,685 - INFO  [WorkerSourceTask-inventory-connector-0:MySqlConnectorTask@215] - Starting MySQL connector from beginning of binlog file null, position 4&#x000A;Mar 16, 2016 3:20:58 PM com.github.shyiko.mysql.binlog.BinaryLogClient connect&#x000A;INFO: Connected to 192.168.99.100:3306 at mysql-bin.000001/4 (sid:184054, cid:7)&#x000A;2016-03-16 15:20:58,793 - INFO  [blc-192.168.99.100:3306:MySqlConnectorTask$1@355] - MySQL Connector connected&#x000A;2016-03-16 15:20:58,794 - INFO  [WorkerSourceTask-inventory-connector-0:WorkerSourceTask$WorkerSourceTaskThread@342] - Source task Thread[WorkerSourceTask-inventory-connector-0,5,main] finished initialization and start&#x000A;2016-03-16 15:21:02,472 - WARN  [kafka-producer-network-thread | producer-1:NetworkClient$DefaultMetadataUpdater@582] - Error while fetching metadata with correlation id 5 : {mysql-server-1.inventory.products=LEADER_NOT_AVAILABLE}&#x000A;2016-03-16 15:21:02,685 - WARN  [kafka-producer-network-thread | producer-1:NetworkClient$DefaultMetadataUpdater@582] - Error while fetching metadata with correlation id 9 : {mysql-server-1.inventory.products_on_hand=LEADER_NOT_AVAILABLE}&#x000A;2016-03-16 15:21:02,896 - WARN  [kafka-producer-network-thread | producer-1:NetworkClient$DefaultMetadataUpdater@582] - Error while fetching metadata with correlation id 12 : {mysql-server-1.inventory.customers=LEADER_NOT_AVAILABLE}&#x000A;2016-03-16 15:21:03,108 - WARN  [kafka-producer-network-thread | producer-1:NetworkClient$DefaultMetadataUpdater@582] - Error while fetching metadata with correlation id 16 : {mysql-server-1.inventory.orders=LEADER_NOT_AVAILABLE}&#x000A;....</pre> </div> </div> <div class="paragraph"> <p>The first line confirms that our MySQL connector started from the beginning of the binlog at position 4 (after the first 4 bytes of the binlog&#8217;s header), that the connector was able to successfully connect, and that the task created by the connector was initialized and started successfully. The last four lines sound ominous, but are basically telling us that new topics were created and Kafka had to assign a new leader. Note the names of the topics:</p> </div> <div class="ulist"> <ul> <li> <p><code>mysql-server-1.inventory.products</code></p> </li> <li> <p><code>mysql-server-1.inventory.products_on_hand</code></p> </li> <li> <p><code>mysql-server-1.inventory.customers</code></p> </li> <li> <p><code>mysql-server-1.inventory.orders</code></p> </li> </ul> </div> <div class="paragraph"> <p>As described in the <a href="/docs/connector/mysql#topic-names">MySQL connector documentation</a>, each topic names start with <code>mysql-server-1</code>, which is the logical name we gave our connector. Each topic name also includes <code>inventory</code>, which is the name of the database. Finally, each topic name concludes with the name of one of the tables in the <code>inventory</code> database. In other words, all of the data change events describing rows in the each table appear in separate topics.</p> </div> <div class="paragraph"> <p>Let&#8217;s look at all of the data change events in the <code>mysql-server-1.inventory.customers</code> topic. Again, we&#8217;ll use the <code>debezium/kafka</code> Docker image to start a new container that connects to Kafka to watch the topic from the beginning of the topic:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --name watcher --rm --link zookeeper:zookeeper debezium/kafka:0.1 watch-topic -a -k mysql-server-1.inventory.customers</code></pre> </div> </div> <div class="paragraph"> <p>Again, we use the <code>--rm</code> flag since we want the container to be removed when it stops, and we use the <code>-a</code> flag on <code>watch-topic</code> to signal that we want to see <em>all</em> events since the beginning of the topic. (If we were to remove the <code>-a</code> flag, we&#8217;d see only the events that are recorded in the topic <em>after</em> we start watching.) The <code>-k</code> flag specifies that the output should include the event&#8217;s key, which in our case contains the row&#8217;s primary key. Here&#8217;s the output:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">Contents of topic mysql-server-1.inventory.customers:&#x000A;{"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"}],"optional":false,"name":"inventory.customers/pk"},"payload":{"id":1001}}    {"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"},{"type":"string","optional":false,"field":"first_name"},{"type":"string","optional":false,"field":"last_name"},{"type":"string","optional":false,"field":"email"}],"optional":false,"name":"inventory.customers"},"payload":{"id":1001,"first_name":"Sally","last_name":"Thomas","email":"sally.thomas@acme.com"}}&#x000A;{"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"}],"optional":false,"name":"inventory.customers/pk"},"payload":{"id":1002}}    {"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"},{"type":"string","optional":false,"field":"first_name"},{"type":"string","optional":false,"field":"last_name"},{"type":"string","optional":false,"field":"email"}],"optional":false,"name":"inventory.customers"},"payload":{"id":1002,"first_name":"George","last_name":"Bailey","email":"gbailey@foobar.com"}}&#x000A;{"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"}],"optional":false,"name":"inventory.customers/pk"},"payload":{"id":1003}}    {"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"},{"type":"string","optional":false,"field":"first_name"},{"type":"string","optional":false,"field":"last_name"},{"type":"string","optional":false,"field":"email"}],"optional":false,"name":"inventory.customers"},"payload":{"id":1003,"first_name":"Edward","last_name":"Walker","email":"ed@walker.com"}}&#x000A;{"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"}],"optional":false,"name":"inventory.customers/pk"},"payload":{"id":1004}}    {"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"},{"type":"string","optional":false,"field":"first_name"},{"type":"string","optional":false,"field":"last_name"},{"type":"string","optional":false,"field":"email"}],"optional":false,"name":"inventory.customers"},"payload":{"id":1004,"first_name":"Anne","last_name":"Kretchmar","email":"annek@noanswer.org"}}</code></pre> </div> </div> <div class="paragraph"> <p>First, note that the utility keeps watching, so any new events would automatically appear as long as the utility keeps running. These events happen to be encoded in JSON, since that&#8217;s how we configured our connector. Each event includes one JSON document for the key, and one for the value.</p> </div> <div class="paragraph"> <p>Also, this <code>watch-topic</code> utility is very simple and is limited in functionality and usefulness - we use it here simply to get an understanding of the kind of events that our connector generates. Our applications would instead use Kafka consumers to consume all of the events, and those consumer libraries offer far more flexibility and power. In fact, properly configured clients enable our applications to never miss any events, even when those applications crash or shutdown gracefullly.</p> </div> <div class="paragraph"> <p>Back to the output events. Let&#8217;s look at the fourth event&#8217;s <em>key</em> document formatted so it is easier to read:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">{&#x000A;    "schema" : {&#x000A;        "type" : "struct",&#x000A;        "fields" : [&#x000A;            {&#x000A;                "type" : "int32",&#x000A;                "optional" : false,&#x000A;                "field" : "id"&#x000A;            }],&#x000A;        "optional" : false,&#x000A;        "name" : "inventory.customers/pk"&#x000A;    },&#x000A;    "payload" : {&#x000A;        "id" : 1004&#x000A;    }&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>The "schema" section describes the structure of the primary key, which in our case has a single field named <code>id</code> whose mandatory value is an <code>int32</code> value. The key is also mandatory and named <code>inventory.customers/pk</code>. The primary key for the row described by the event is in the "payload" section, where we see that this event is for the row identified by an <code>id</code> of <code>1001</code>.</p> </div> <div class="paragraph"> <p>Now let&#8217;s look at the first event&#8217;s <em>value</em> document formatted so it is easier to read:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">{&#x000A;    "schema" : {&#x000A;        "type" : "struct",&#x000A;        "fields" : [&#x000A;            {&#x000A;                "type" : "int32",&#x000A;                "optional" : false,&#x000A;                "field" : "id"&#x000A;            }, {&#x000A;                "type" : "string",&#x000A;                "optional" : false,&#x000A;                "field" : "first_name"&#x000A;            }, {&#x000A;                "type" : "string",&#x000A;                "optional" : false,&#x000A;                "field" : "last_name"&#x000A;            }, {&#x000A;                "type" : "string",&#x000A;                "optional" : false,&#x000A;                "field" : "email"&#x000A;            }],&#x000A;        "optional" : false,&#x000A;        "name" : "inventory.customers"&#x000A;    },&#x000A;    "payload" : {&#x000A;        "id" : 1004,&#x000A;        "first_name" : "Anne",&#x000A;        "last_name" : "Kretchmar",&#x000A;        "email" : "annek@noanswer.org"&#x000A;    }&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>Once again the "schema" section describes the structure of our row, and in our case contains 4 mandatory fields: <code>id</code> is of type <code>int32</code> while <code>first_name</code>, <code>last_name</code>, and <code>email</code> are of type <code>string</code>. The row itself is in the "payload" section, and here we see the actual values for the ID, first name, last name, and email.</p> </div> <div class="paragraph"> <p>We can compare these to the state of the database. Go back to the terminal that is running the MySQL command line client, and run the following statement:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-sql" data-lang="sql">mysql&gt; SELECT * FROM customers;</code></pre> </div> </div> <div class="paragraph"> <p>which produces the following output:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-sql" data-lang="sql">+------+------------+-----------+-----------------------+&#x000A;| id   | first_name | last_name | email                 |&#x000A;+------+------------+-----------+-----------------------+&#x000A;| 1001 | Sally      | Thomas    | sally.thomas@acme.com |&#x000A;| 1002 | George     | Bailey    | gbailey@foobar.com    |&#x000A;| 1003 | Edward     | Walker    | ed@walker.com         |&#x000A;| 1004 | Anne       | Kretchmar | annek@noanswer.org    |&#x000A;+------+------------+-----------+-----------------------+&#x000A;4 rows in set (0.00 sec)</code></pre> </div> </div> <div class="paragraph"> <p>As we can see, all of our event records match the database.</p> </div> <div class="paragraph"> <p>Now that we&#8217;re monitoring changes, what happens when we <strong>change</strong> one of the records in the database? Run the following statement in the MySQL command line client:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-sql" data-lang="sql">mysql&gt; UPDATE customers SET first_name='Anne Marie' WHERE id=1004;</code></pre> </div> </div> <div class="paragraph"> <p>which produces the following output:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code>Query OK, 1 row affected (0.05 sec)&#x000A;Rows matched: 1  Changed: 1  Warnings: 0</code></pre> </div> </div> <div class="paragraph"> <p>Rerun the <code>select &#8230;&#8203;</code> statement to see the updated table:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-sql" data-lang="sql">mysql&gt; select * from customers;&#x000A;+------+------------+-----------+-----------------------+&#x000A;| id   | first_name | last_name | email                 |&#x000A;+------+------------+-----------+-----------------------+&#x000A;| 1001 | Sally      | Thomas    | sally.thomas@acme.com |&#x000A;| 1002 | George     | Bailey    | gbailey@foobar.com    |&#x000A;| 1003 | Edward     | Walker    | ed@walker.com         |&#x000A;| 1004 | Anne Marie | Kretchmar | annek@noanswer.org    |&#x000A;+------+------------+-----------+-----------------------+&#x000A;4 rows in set (0.00 sec)</code></pre> </div> </div> <div class="paragraph"> <p>Now, go back to the terminal running <code>watch-topic</code> and we should see a new fifth event:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">{"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"}],"optional":false,"name":"inventory.customers/pk"},"payload":{"id":1004}}    {"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"},{"type":"string","optional":false,"field":"first_name"},{"type":"string","optional":false,"field":"last_name"},{"type":"string","optional":false,"field":"email"}],"optional":false,"name":"inventory.customers"},"payload":{"id":1004,"first_name":"Anne Marie","last_name":"Kretchmar","email":"annek@noanswer.org"}}</code></pre> </div> </div> <div class="paragraph"> <p>Let&#8217;s reformat the key to be easier to read:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">{&#x000A;    "schema" : {&#x000A;        "type" : "struct",&#x000A;        "fields" : [&#x000A;            {&#x000A;                "type" : "int32",&#x000A;                "optional" : false,&#x000A;                "field" : "id"&#x000A;            }],&#x000A;        "optional" : false,&#x000A;        "name" : "inventory.customers/pk"&#x000A;    },&#x000A;    "payload" : {&#x000A;        "id" : 1004&#x000A;    }&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>This key is exactly the same key as what we saw in the fourth record. Here&#8217;s the value formatted to be easier to read:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">{&#x000A;    "schema" : {&#x000A;        "type" : "struct",&#x000A;        "fields" : [&#x000A;            {&#x000A;                "type" : "int32",&#x000A;                "optional" : false,&#x000A;                "field" : "id"&#x000A;            }, {&#x000A;                "type" : "string",&#x000A;                "optional" : false,&#x000A;                "field" : "first_name"&#x000A;            }, {&#x000A;                "type" : "string",&#x000A;                "optional" : false,&#x000A;                "field" : "last_name"&#x000A;            }, {&#x000A;                "type" : "string",&#x000A;                "optional" : false,&#x000A;                "field" : "email"&#x000A;            }],&#x000A;        "optional" : false,&#x000A;        "name" : "inventory.customers"&#x000A;    },&#x000A;    "payload" : {&#x000A;        "id" : 1004,&#x000A;        "first_name" : "Anne Marie",&#x000A;        "last_name" : "Kretchmar",&#x000A;        "email" : "annek@noanswer.org"&#x000A;    }&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>When we compare this to the value in the fourth event, we see that the <code>first_name</code> value is now <code>Anne Marie</code>, which is the new value.</p> </div> <div class="paragraph"> <p>Insert and update statements look very similar, and the only way to tell them apart is to know whether the record previously existed prior to an event. Clients that need to make this distinction will likely already have this knowledge in the form of a cache or local storage.</p> </div> <div class="paragraph"> <p>When a row is deleted, the event contains a key that matches the row&#8217;s primary (or unique) key, but the value is null. Since Anne Marie has not placed any orders, we can remove her record from our database using the MySQL command line client:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-sql" data-lang="sql">mysql&gt; DELETE FROM customers WHERE id=1004;</code></pre> </div> </div> <div class="paragraph"> <p>In our terminal running <code>watch-topic</code>, we see a new event:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">{"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"}],"optional":false,"name":"inventory.customers/pk"},"payload":{"id":1004}}    {"schema":null,"payload":null}</code></pre> </div> </div> <div class="paragraph"> <p>Once again, let&#8217;s reformat the key to be easier to read:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">{&#x000A;    "schema" : {&#x000A;        "type" : "struct",&#x000A;        "fields" : [&#x000A;            {&#x000A;                "type" : "int32",&#x000A;                "optional" : false,&#x000A;                "field" : "id"&#x000A;            }],&#x000A;        "optional" : false,&#x000A;        "name" : "inventory.customers/pk"&#x000A;    },&#x000A;    "payload" : {&#x000A;        "id" : 1004&#x000A;    }&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>Again, this key is exactly the same key as what we saw in the previous record. Here&#8217;s the value formatted to be easier to read:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">{&#x000A;    "schema" :  null,&#x000A;    "payload" : null&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>The value has no schema and no payload, which means the record no longer exists.</p> </div> </div> <div class="sect2"> <h3 id="restart-kafka-connect">Restart the Kafka Connect service</h3> <div class="paragraph"> <p>One feature of the Kafka Connect service is that it automatically manages tasks for the registered connectors. And, because it stores its data in Kafka, if a running service stops or goes away completely, upon restart (perhaps on another host) the server will start any non-running tasks. To demostrate this, let&#8217;s stop our Kafka Connect service, change some data in the database, and restart our service.</p> </div> <div class="paragraph"> <p>In a new terminal, use the following Docker commands to stop and remove the <code>connect</code> container that is running our Kafka Connect service:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ docker stop connect&#x000A;$ docker rm connect</code></pre> </div> </div> <div class="paragraph"> <p>Stopping the container like this stops the process running inside of it, but the Kafka Connect service handles this by gracefully shutting down. Removing the container ensures that we won&#8217;t simply restart the container.</p> </div> <div class="paragraph"> <p>While the service is down, let&#8217;s go back to the MySQL command line client and add a few records:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-sql" data-lang="sql">mysql&gt; INSERT INTO customers VALUES (default, "Ken", "Thompson", "kitt@acme.com");&#x000A;mysql&gt; INSERT INTO customers VALUES (default, "Kenneth", "Anderson", "kander@acme.com");</code></pre> </div> </div> <div class="paragraph"> <p>Notice that in the terminal where we&#8217;re running <code>watch-topic</code>, there&#8217;s been no update. Also, we&#8217;re still able to watch the topic because Kafka is still running. (In a production system, you would have enough brokers to handle the producers and consumers, and to maintain a minimum number of in sync replicas for each topic. So if enough brokers fail such that there are not the minimum number of ISRs, Kafka should become unavailable. Producers, like the Debezium connectors, and consumers will simply wait patiently for the Kafka cluster or network to recover. Yes, that means that your consumers might temporarily see no change events as data is changed in the databases, but that&#8217;s because none are being produced. As soon as the Kafka cluster is restarted or the network recovers, Debezium will continue producing change events while your consumers will continue consuming events where they left off.)</p> </div> <div class="paragraph"> <p>Now, in a new terminal, start a new container using the <em>same</em> command we used before:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --name connect -p 8083:8083 -e GROUP_ID=1 -e CONFIG_STORAGE_TOPIC=my-connect-configs -e OFFSET_STORAGE_TOPIC=my-connect-offsets -e ADVERTISED_HOST_NAME=$(echo $DOCKER_HOST | cut -f3  -d'/' | cut -f1 -d':') --link zookeeper:zookeeper --link kafka:kafka debezium/connect:0.1</code></pre> </div> </div> <div class="paragraph"> <p>This creates a whole new container, and since we&#8217;ve intialized it with the same topic information the new service can connect to Kafka, read the previous service&#8217;s configuration and start the registered connectors, which will continue where they last left off.</p> </div> <div class="paragraph"> <p>Jump back to the terminal running <code>watch-topic</code>, and you should now see two new records we added to the MySQL database:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-json" data-lang="json">{"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"}],"optional":false,"name":"inventory.customers/pk"},"payload":{"id":1005}}    {"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"},{"type":"string","optional":false,"field":"first_name"},{"type":"string","optional":false,"field":"last_name"},{"type":"string","optional":false,"field":"email"}],"optional":false,"name":"inventory.customers"},"payload":{"id":1005,"first_name":"Ken","last_name":"Thompson","email":"kitt@acme.com"}}&#x000A;{"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"}],"optional":false,"name":"inventory.customers/pk"},"payload":{"id":1006}}    {"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"},{"type":"string","optional":false,"field":"first_name"},{"type":"string","optional":false,"field":"last_name"},{"type":"string","optional":false,"field":"email"}],"optional":false,"name":"inventory.customers"},"payload":{"id":1006,"first_name":"Kenneth","last_name":"Anderson","email":"kander@acme.com"}}</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="exploration">Exploration</h3> <div class="paragraph"> <p>Go ahead and use the MySQL command line client to add, modify, and remove rows to the database tables, and see the effect on the topics. You may need to start multiple <code>watch-topic</code> commands for each topic. And remember that you can&#8217;t remove a row that is referenced by a foreign key. Have fun!</p> </div> </div> <div class="sect2"> <h3 id="cleanup">Clean up</h3> <div class="paragraph"> <p>You can use Docker to stop and remove all of the running containers:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ docker stop mysqlterm watcher connect mysql kafka zookeeper&#x000A;$ docker rm mysqlterm watcher connect mysql kafka zookeeper</code></pre> </div> </div> <div class="paragraph"> <p>Then, verify that all of the other processes are stopped:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-bash" data-lang="bash">$ docker ps -a</code></pre> </div> </div> <div class="paragraph"> <p>You can stop any of them using <code>docker stop &lt;name&gt;</code> or <code>docker stop &lt;containerId&gt;</code>.</p> </div> </div> </div> </div> </div> </div> </div> <footer class="container"> <div class="row"> <div class="col-md-5 col-md-offset-1"> <h4>Debezium</h4> <p> &#169; 2016 Debezium Community <br> <br> <i class="icon-fire"></i> Mixed with <a href="http://twitter.github.com/bootstrap">Bootstrap</a>, baked by <a href="http://awestruct.org">Awestruct</a>. <br> <i class="icon-flag"></i> Website and docs licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>. <br> <i class="icon-flag-alt"></i> Code released under <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, v2.0</a>. <br> <i class="icon-file-alt"></i> <a href="http://www.redhat.com/legal/legal_statement.html" title="Terms">Terms</a> | <a href="http://www.redhat.com/legal/privacy_statement.html" title="Privacy Policy">Privacy</a> </p> </div> <div class="col-md-3"> <h4>Documentation</h4> <ul class="list-unstyled"> <li> <a href="/docs/features" title="Features">Features</a> </li> <li> <a href="/docs/deploy" title="Deploy">Deploy</a> </li> <li> <a href="/docs/manage" title="Manage">Manage</a> </li> <li> <a href="/docs/architecture" title="Architecture">Architecture</a> </li> <li> <a href="/docs/faq" title="FAQ">FAQ</a> </li> <li> <a href="/docs/contribute" title="Contribute">Contribute</a> </li> </ul> </div> <div class="col-md-3"> <h4>Connect</h4> <ul class="list-unstyled"> <li> <a href="/blog" title="Blog">Blog</a> </li> <li> <a href="http://twitter.com/debezium" title="Twitter">Twitter</a> </li> <li> <a href="http://github.com/debezium" title="GitHub">GitHub</a> </li> <li> <a href="https://gitter.im/debezium/dev" title="Chat">Chat</a> </li> <li> <a href="https://groups.google.com/forum/#!forum/debezium" title="Google Groups">Google Groups</a> </li> <li> <a href="http://stackoverflow.com/questions/tagged/debezium" title="StackOverflow">StackOverflow</a> </li> </ul> </div> </div> </footer> <div class="container" id="companyfooter"> <div class="redhatlogo"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="http://static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="http://static.jboss.org/theme/js/libs/bootstrap-community/3.2.0.1/bootstrap-community.min.js"></script> <script type='text/javascript' language='JavaScript' src='http://www.redhat.com/j/elqNow/elqCfg.js'></script> <script type='text/javascript' language='JavaScript' src='http://www.redhat.com/j/elqNow/elqImg.js'></script> <div id="oTags"> <script type="text/javascript" src="//www.redhat.com/j/s_code.js"></script> <script type="text/javascript"><!--
        var coreUrl = encodeURI(document.URL.split("?")[0]).replace(/-/g," ");
        var urlSplit = coreUrl.toLowerCase().split(/\//);
        var urlLast = urlSplit[urlSplit.length-1];
        var pageNameString = "";
        var siteName = "";
        var minorSectionIndex = 3
        if (urlLast == "") {
            urlSplit.splice(-1,1);
        }
        if (urlLast.search(/\./) >= 0) {
            if (urlLast == "index.html") {
                urlSplit.splice(-1,1);
            }
            else {
                urlSplit[urlSplit.length-1] = urlLast.split(".").splice(0,1);
            }
        }
        siteName = urlSplit[2].split(".")[1];
        s.prop14 = s.eVar27 = siteName || "";
        s.prop15 = s.eVar28 = urlSplit[minorSectionIndex] || "";
        s.prop16 = s.eVar29 = urlSplit[minorSectionIndex+1] || "";
        pageNameString = urlSplit.splice(3).join(" | ");
        s.pageName = "jboss | community | " + siteName + " | " + pageNameString;
        s.server = "jboss";
        s.channel = "jboss | community";
        s.prop4 = s.eVar23 = encodeURI(document.URL);
        s.prop21 = s.eVar18 = coreUrl;
        s.prop2 = s.eVar22 = "en";
        s.prop3 = s.eVar19 = "us";
        //--></script> <script type="text/javascript" src="//www.redhat.com/j/rh_omni_footer.js"></script> <script language="JavaScript" type="text/javascript"><!--
        if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
        //--></script> <noscript><a href="http://www.omniture.com" title="Web Analytics"><img src="https://smtrcs.redhat.com/b/ss/redhatcom,redhatglobal/1/H.25.4--NS/0?[AQB]&cdp=3&[AQE]" height="1" width="1" border="0" alt=""/></a></noscript> </div> <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      </script> <script type="text/javascript">
      try {
      var pageTracker = _gat._getTracker("UA-10656779-1");
      pageTracker._trackPageview();
      } catch(err) {}</script> </div> </body> </html>